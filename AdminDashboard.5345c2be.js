function e(e,s,t,a){Object.defineProperty(e,s,{get:t,set:a,enumerable:!0,configurable:!0})}var s=globalThis.parcelRequireb79f,t=s.register;t("dXtBz",function(t,a){Object.defineProperty(t.exports,"__esModule",{value:!0,configurable:!0}),e(t.exports,"default",()=>p);var l=s("ayMG0"),i=s("acw62"),r=s("aOD4d"),n=s("6Eazr"),c=s("2A5UH"),o=s("4XiCD"),d=s("e3nvF"),h=s("hyYFF"),m=s("gqAsg"),u=s("bU9CP"),b=s("fAZ67"),f=s("6AR8M"),x=s("ilpIi");function p({user:e,onLogout:s}){let[t,a]=(0,i.useState)([]),[p,j]=(0,i.useState)([]),[y,g]=(0,i.useState)([]),[N,v]=(0,i.useState)(null),[S,C]=(0,i.useState)([]),[T,P]=(0,i.useState)(!0),[D,w]=(0,i.useState)(!1),[k,A]=(0,i.useState)(!1),[E,_]=(0,i.useState)(!1),[I,$]=(0,i.useState)("classes"),[F,O]=(0,i.useState)({isOpen:!1,title:"",message:"",onConfirm:()=>{},type:"danger",confirmText:"Confirm"}),M=(e,s,t,a="danger",l="Confirm")=>{O({isOpen:!0,title:e,message:s,onConfirm:t,type:a,confirmText:l})};(0,i.useEffect)(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);let U=(0,i.useRef)(null),R=(0,i.useRef)(null),[B,L]=(0,i.useState)({name:"",hallNumber:""}),[W,z]=(0,i.useState)({id:null,name:"",username:"",password:"",freePeriodMode:"auto",manualFreePeriods:0}),[H,Y]=(0,i.useState)({id:null,className:"",name:"",subjectType:"Core",hoursPerWeek:6,isContinuous:!1,blockSize:2,teacher:""}),G=p.filter(e=>"staff"===e.role),V=(e,s,t=3e3,a=null)=>{let l={message:e,type:s,id:Date.now(),undoAction:a};C(e=>[...e,l]),setTimeout(()=>q(l.id),t)},q=e=>{C(s=>s.filter(s=>s.id!==e))},X=e=>{if(!e)return null;let s={};return Object.keys(e).forEach(t=>{let a=e[t];if(Array.isArray(a)&&a.length>0&&Array.isArray(a[0]))s[t]=a;else if(Array.isArray(a)){let e=[[],[],[],[],[]];a.forEach(s=>{s&&"number"==typeof s.day&&"number"==typeof s.period&&(e[s.day]||(e[s.day]=[]),e[s.day][s.period]={subject:s.subject,teacher:s.teacher,class:s.class,type:s.type})}),e.forEach((s,t)=>{e[t]||(e[t]=[]);for(let s=0;s<6;s++)e[t][s]||(e[t][s]=a[0]?.class!==void 0?{subject:"FREE",class:"-",type:"free"}:null)}),s[t]=e}}),s},K=e=>{if(!e)return{};let s={};return Object.keys(e).forEach(t=>{let a=e[t]||[],l=[];a.forEach((e,s)=>{(e||[]).forEach((e,t)=>{l.push({day:s,period:t,subject:e?.subject||null,teacher:e?.teacher||null,type:e?.type||null})})}),s[t]=l}),s},J=e=>{if(!e)return{};let s={};return Object.keys(e).forEach(t=>{let a=e[t]||[],l=[];a.forEach((e,s)=>{(e||[]).forEach((e,t)=>{l.push({day:s,period:t,subject:e?.subject||null,class:e?.class||null,type:e?.type||null})})}),s[t]=l}),s},Z=async()=>{P(!0);try{let[e,s,t,l]=await Promise.all([(0,x.getDocs)((0,x.collection)(b.db,"classes")),(0,x.getDocs)((0,x.collection)(b.db,"staff")),(0,x.getDocs)((0,x.collection)(b.db,"subjects")),(0,x.getDocs)((0,x.collection)(b.db,"timetable"))]);if(a(e.docs.map(e=>({id:e.id,...e.data()}))),j(s.docs.map(e=>({id:e.id,...e.data()}))),g(t.docs.map(e=>({id:e.id,...e.data()}))),!l.empty){let e=l.docs[0].data(),s={classTimetables:X(e.classTimetables),staffTimetables:X(e.staffTimetables)};v(s)}}catch(e){V("âŒ Error loading data: "+e.message,"error"),console.error(e)}P(!1)};(0,i.useEffect)(()=>{Z()},[]);let Q=async e=>{try{if("class"===e.type){let{id:s,...t}=e.data;await (0,x.setDoc)((0,x.doc)(b.db,"classes",s),t)}else if("staff"===e.type){let{id:s,...t}=e.data;await (0,x.setDoc)((0,x.doc)(b.db,"staff",s),t),e.data.firebaseUid&&await (0,x.setDoc)((0,x.doc)(b.db,"users",e.data.firebaseUid),{name:e.data.name,username:e.data.username,role:"staff"})}else if("subject"===e.type){let{id:s,...t}=e.data;await (0,x.setDoc)((0,x.doc)(b.db,"subjects",s),t)}else if("classTimetable"===e.type){let s={...N.classTimetables,[e.className]:e.data},t=(0,x.collection)(b.db,"timetable"),a=await (0,x.getDocs)(t);a.empty||await (0,x.updateDoc)((0,x.doc)(b.db,"timetable",a.docs[0].id),{classTimetables:K(s)}),v({...N,classTimetables:s})}await Z(),V(" Data restored!","success")}catch(e){console.error("Restore error:",e),V("Ã¢ÂÅ’ Restore failed: "+e.message,"error")}},ee=async()=>{if(!B.name)return V("Enter class name","error");if(t.find(e=>e.name===B.name&&!B.id))return V("Class already exists","error");try{if(B.id)await (0,x.updateDoc)((0,x.doc)(b.db,"classes",B.id),{name:B.name,hallNumber:B.hallNumber}),a(t.map(e=>e.id===B.id?{id:B.id,...B}:e)),V("âœ… Class updated!","success");else{let e=await (0,x.addDoc)((0,x.collection)(b.db,"classes"),{name:B.name,hallNumber:B.hallNumber||""});a([...t,{id:e.id,name:B.name,hallNumber:B.hallNumber||""}]),V("âœ… Class added!","success")}L({name:"",hallNumber:""}),_(!1)}catch(e){V("âŒ Operation failed","error")}},es=e=>{L({id:e.id,name:e.name,hallNumber:e.hallNumber||""}),_(!0),window.scrollTo({top:0,behavior:"smooth"})},et=e=>{M("Delete Class?","This will also remove its subjects and timetable. This action cannot be undone.",async()=>{try{let s=t.find(s=>s.id===e);if(!s)return;let l={type:"class",data:{...s}};await (0,x.deleteDoc)((0,x.doc)(b.db,"classes",e));let i=y.filter(e=>e.className===s.name);i.length&&await Promise.all(i.map(e=>(0,x.deleteDoc)((0,x.doc)(b.db,"subjects",e.id))));let r=y.filter(e=>e.className!==s.name),n=N?.classTimetables?{...N.classTimetables}:null,c=N?.staffTimetables?{...N.staffTimetables}:null;if(n&&n[s.name]&&delete n[s.name],c&&Object.keys(c).forEach(e=>{c[e]=c[e].map(e=>e.map(e=>e?.class===s.name?{subject:"FREE",class:"-",type:"free"}:e))}),n||c){let e=(0,x.collection)(b.db,"timetable"),s=await (0,x.getDocs)(e);s.empty||await (0,x.updateDoc)((0,x.doc)(b.db,"timetable",s.docs[0].id),{...n?{classTimetables:K(n)}:{},...c?{staffTimetables:J(c)}:{}})}a(t.filter(s=>s.id!==e)),g(r),N&&v({...N,...n?{classTimetables:n}:{},...c?{staffTimetables:c}:{}}),V("âœ… Class deleted","success",5e3,()=>Q(l))}catch(e){console.error("Delete error:",e),V("âŒ Failed to delete","error")}},"danger","Delete")},ea=async()=>{if(!W.name||!W.username)return V("Fill all required fields","error");try{if(W.id){let e=p.find(e=>e.id===W.id),{password:s,...t}=W,a={name:t.name,freePeriodMode:t.freePeriodMode,manualFreePeriods:t.manualFreePeriods};e.username!==t.username&&(a.username=t.username),await (0,x.updateDoc)((0,x.doc)(b.db,"staff",W.id),a),e.firebaseUid&&await (0,x.updateDoc)((0,x.doc)(b.db,"users",e.firebaseUid),{name:W.name,username:W.username,role:"staff"}),s&&s.trim()?(await (0,x.updateDoc)((0,x.doc)(b.db,"staff",W.id),{tempPassword:s,passwordLastChanged:new Date().toISOString(),needsPasswordChange:!0}),V("âœ… Temporary password set. Share it with staff.","success")):V("âœ… Staff updated!","success"),j(p.map(e=>e.id===W.id?{...e,...a}:e)),ei(),w(!1);return}if(!W.password)return V("Password required","error");let e=`${W.username}@timetable.com`,s=(await (0,f.createUserWithEmailAndPassword)(b.auth,e,W.password)).user.uid,t={name:W.name,username:W.username,freePeriodMode:W.freePeriodMode,manualFreePeriods:W.manualFreePeriods,role:"staff",firebaseUid:s},a=await (0,x.addDoc)((0,x.collection)(b.db,"staff"),t);await (0,x.setDoc)((0,x.doc)(b.db,"users",s),{name:W.name,username:W.username,role:"staff"}),j([...p,{id:a.id,...t}]),ei(),w(!1),V("âœ… Staff added!","success")}catch(e){V("âŒ Operation failed: "+e.message,"error"),console.error(e)}},el=e=>{z({...e,password:""}),w(!0),setTimeout(()=>{U.current?.scrollIntoView({behavior:"smooth",block:"center"})},100)},ei=()=>{z({id:null,name:"",username:"",password:"",freePeriodMode:"auto",manualFreePeriods:0})},er=e=>{M("Delete Staff?","Are you sure you want to delete this staff member?",async()=>{try{let s=p.find(s=>s.id===e);if(!s)return;let t={type:"staff",data:{...s}};await (0,x.deleteDoc)((0,x.doc)(b.db,"staff",e)),s.firebaseUid&&await (0,x.deleteDoc)((0,x.doc)(b.db,"users",s.firebaseUid)),j(p.filter(s=>s.id!==e)),V("âœ… Staff deleted","success",5e3,()=>Q(t))}catch(e){console.error("Delete staff error:",e),V("âŒ Failed to delete","error")}},"danger","Delete")},en=async()=>{if(!H.className||!H.name||!H.teacher)return V("Fill all required fields","error");try{let e={className:H.className,name:H.name,subjectType:H.subjectType,hoursPerWeek:H.hoursPerWeek,isContinuous:H.isContinuous,blockSize:H.blockSize,teacher:H.teacher};if(H.id)await (0,x.updateDoc)((0,x.doc)(b.db,"subjects",H.id),e),g(y.map(s=>s.id===H.id?{id:H.id,...e}:s)),V("âœ… Subject updated!","success");else{let s=await (0,x.addDoc)((0,x.collection)(b.db,"subjects"),e);g([...y,{id:s.id,...e}]),V("âœ… Subject added!","success")}eo(),A(!1)}catch(e){V("âŒ Operation failed","error"),console.error(e)}},ec=e=>{Y({id:e.id,className:e.className,name:e.name,subjectType:e.subjectType,hoursPerWeek:e.hoursPerWeek,isContinuous:e.isContinuous||!1,blockSize:e.blockSize||2,teacher:e.teacher}),A(!0),setTimeout(()=>{R.current?.scrollIntoView({behavior:"smooth",block:"center"})},100)},eo=()=>{Y({id:null,className:"",name:"",subjectType:"Core",hoursPerWeek:6,isContinuous:!1,blockSize:2,teacher:""})},ed=e=>{M("Delete Subject?","Are you sure you want to delete this subject?",async()=>{try{let s=y.find(s=>s.id===e);if(!s)return;let t={type:"subject",data:{...s}};await (0,x.deleteDoc)((0,x.doc)(b.db,"subjects",e)),g(y.filter(s=>s.id!==e)),V("âœ… Subject deleted","success",5e3,()=>Q(t))}catch(e){console.error("Delete subject error:",e),V("âŒ Failed to delete","error")}},"danger","Delete")},eh=async()=>{P(!0);try{let e=new(0,u.TimetableGenerator)(t,p.filter(e=>"staff"===e.role),y),s=e.validate();if(!s.valid){V("âŒ Validation: "+s.errors[0],"error"),P(!1);return}let a=e.generate();if(a.success){let e={},s={};Object.keys(a.classTimetables).forEach(s=>{e[s]=a.classTimetables[s].map((e,s)=>e.map((e,t)=>({day:s,period:t,subject:e?.subject||null,teacher:e?.teacher||null,type:e?.type||null}))).flat()}),Object.keys(a.staffTimetables).forEach(e=>{s[e]=a.staffTimetables[e].map((e,s)=>e.map((e,t)=>({day:s,period:t,subject:e?.subject||null,class:e?.class||null,type:e?.type||null}))).flat()});let t={classTimetables:e,staffTimetables:s,generatedAt:new Date().toISOString()},l=(0,x.collection)(b.db,"timetable"),i=await (0,x.getDocs)(l);for(let e of(i.empty?await (0,x.addDoc)(l,t):await (0,x.updateDoc)((0,x.doc)(b.db,"timetable",i.docs[0].id),t),p.filter(e=>"staff"===e.role))){let t=s[e.name];t&&await (0,x.setDoc)((0,x.doc)(b.db,"staffTimetables",e.id),{staffName:e.name,timetable:t,generatedAt:new Date().toISOString()})}let r={};Object.keys(e).forEach(s=>{let t=[[],[],[],[],[]];e[s].forEach(e=>{t[e.day]||(t[e.day]=[]),t[e.day][e.period]={subject:e.subject,teacher:e.teacher,type:e.type}}),t.forEach((e,s)=>{t[s]||(t[s]=[]);for(let e=0;e<6;e++)t[s][e]||(t[s][e]=null)}),r[s]=t});let n={};Object.keys(s).forEach(e=>{let t=[[],[],[],[],[]];s[e].forEach(e=>{t[e.day]||(t[e.day]=[]),t[e.day][e.period]={subject:e.subject,class:e.class,type:e.type}}),t.forEach((e,s)=>{t[s]||(t[s]=[]);for(let e=0;e<6;e++)t[s][e]||(t[s][e]={subject:"FREE",class:"-",type:"free"})}),n[e]=t}),v({classTimetables:r,staffTimetables:n}),$("results"),V("âœ… Timetable generated & saved!","success"),setTimeout(()=>{document.getElementById("view-timetables")?.scrollIntoView({behavior:"smooth"})},300)}else V("âŒ Failed: "+a.error,"error")}catch(e){V("âŒ Error: "+e.message,"error"),console.error(e)}P(!1)};return T?(0,l.jsx)(r.default,{variant:"spiral",colorScheme:"gradient",interactive:!0,children:(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",color:"white",fontSize:"24px",gap:"20px"},children:[(0,l.jsx)("div",{className:"spinner"}),(0,l.jsx)("div",{children:"Loading..."})]})}):(0,l.jsx)(r.default,{variant:"spiral",colorScheme:"gradient",interactive:!0,children:(0,l.jsxs)("div",{className:"min-h-screen relative z-10 text-white",children:[(0,l.jsxs)("div",{className:"header-content",children:[(0,l.jsx)("h1",{className:"text-white",children:"Admin Dashboard"}),(0,l.jsx)("div",{className:"header-actions",children:(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>{M("Logout","Are you sure you want to logout?",s,"danger","Logout")},children:"Logout"})})]}),(0,l.jsxs)("div",{className:"segmented-nav",children:[(0,l.jsx)("button",{className:`segmented-item ${"classes"===I?"active":""}`,onClick:()=>{$("classes"),document.getElementById("classes-section")?.scrollIntoView({behavior:"smooth"})},children:"Classes"}),(0,l.jsx)("button",{className:`segmented-item ${"staff"===I?"active":""}`,onClick:()=>{$("staff"),document.getElementById("staff-section")?.scrollIntoView({behavior:"smooth"})},children:"Staff"}),(0,l.jsx)("button",{className:`segmented-item ${"subjects"===I?"active":""}`,onClick:()=>{$("subjects"),document.getElementById("subject-section")?.scrollIntoView({behavior:"smooth"})},children:"Subjects"}),(0,l.jsx)("button",{className:`segmented-item ${"generate"===I?"active":""}`,onClick:()=>{$("generate"),document.getElementById("generate-section")?.scrollIntoView({behavior:"smooth"})},children:"Generate"}),(0,l.jsx)("button",{className:`segmented-item ${"results"===I?"active":""}`,onClick:()=>{$("results"),document.getElementById("view-timetables")?.scrollIntoView({behavior:"smooth"})},children:"Results"})]}),(0,l.jsxs)("div",{className:"content",children:[(0,l.jsxs)("div",{className:"section",id:"classes-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“š"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Classes"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("h3",{children:["Existing Classes (",t.length,")"]}),0===t.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"No classes added yet"}):(0,l.jsx)(l.Fragment,{children:[...t].sort((e,s)=>e.name.localeCompare(s.name)).map(e=>{let s=y.filter(s=>s.className===e.name),t=s.reduce((e,s)=>e+s.hoursPerWeek,0),a=t/30*100;return(0,l.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,l.jsxs)("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",color:"#1e293b",flexWrap:"wrap"},children:[(0,l.jsxs)("h4",{style:{margin:0,display:"flex",alignItems:"center",gap:"8px"},children:["Class ",(0,l.jsx)("strong",{children:e.name})]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px",color:"#64748b",fontWeight:600},children:[(0,l.jsxs)("span",{children:[t,"/30 hours"]}),(0,l.jsxs)("span",{children:[Math.max(30-t,0),"h remaining"]})]})]}),(0,l.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden",marginBottom:"15px"},children:(0,l.jsx)("div",{style:{height:"100%",width:`${Math.min(a,100)}%`,backgroundColor:30===t?"#10b981":"#f59e0b",transition:"width 0.3s ease"}})}),(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Hall Number"}),(0,l.jsx)("th",{children:"Subjects"}),(0,l.jsx)("th",{children:"Hours"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.hallNumber||"-"}),(0,l.jsx)("td",{children:s.length}),(0,l.jsx)("td",{children:(0,l.jsxs)("span",{className:`badge ${30===t?"badge-success":"badge-danger"}`,children:[t,"/30h"]})}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>es(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>et(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]})})]})}),(0,l.jsx)("div",{className:"mobile-cards",children:(0,l.jsxs)("div",{className:"mobile-card",children:[(0,l.jsxs)("div",{className:"mobile-card-header",children:[(0,l.jsxs)("strong",{children:["Hall: ",e.hallNumber||"-"]}),(0,l.jsxs)("span",{className:`badge ${30===t?"badge-success":"badge-danger"}`,children:[t,"/30h"]})]}),(0,l.jsx)("div",{className:"mobile-card-body",children:(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{children:"Subjects"})," ",(0,l.jsx)("strong",{children:s.length})]})}),(0,l.jsxs)("div",{className:"mobile-card-actions",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>es(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>et(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})]})})]},e.id)})}),(0,l.jsx)("button",{className:"btn btn-success btn-sm",onClick:()=>{_(!0),L({id:null,name:"",hallNumber:""})},style:{marginTop:"15px"},children:"Add Class"})]}),E&&(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:B.id?"Edit Class":"Add New Class"}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Class Name"}),(0,l.jsx)("input",{type:"text",value:B.name,onChange:e=>L({...B,name:e.target.value.toUpperCase()}),placeholder:"CS3A, EE2B"})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Hall Number (Optional)"}),(0,l.jsx)("input",{type:"text",value:B.hallNumber,onChange:e=>L({...B,hallNumber:e.target.value}),placeholder:"Hall 101"})]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:ee,children:B.id?"Update Class":"Add Class"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{L({name:"",hallNumber:""}),_(!1)},children:"Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",id:"staff-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"Ã°Å¸â€˜Â¥"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Staff"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("h3",{children:["Existing Staff (",G.length,")"]}),0===G.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"No staff added yet"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"S.No"}),(0,l.jsx)("th",{children:"Name"}),(0,l.jsx)("th",{children:"Username"}),(0,l.jsx)("th",{children:"Free Periods"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:G.map((e,s)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:(0,l.jsxs)("span",{className:"staff-badge",children:["S",s+1]})}),(0,l.jsx)("td",{children:(0,l.jsx)("strong",{children:e.name})}),(0,l.jsx)("td",{children:e.username}),(0,l.jsx)("td",{children:"manual"===e.freePeriodMode?`Manual (${e.manualFreePeriods} free periods)`:"Auto"}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>el(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>er(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]},e.id))})]})}),(0,l.jsx)("div",{className:"mobile-cards",children:G.map((e,s)=>(0,l.jsxs)("div",{className:"mobile-card",children:[(0,l.jsxs)("div",{className:"mobile-card-header",children:[(0,l.jsx)("strong",{children:e.name}),(0,l.jsxs)("span",{className:"staff-badge",children:["S",s+1]})]}),(0,l.jsxs)("div",{className:"mobile-card-body",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{children:"Username"})," ",(0,l.jsx)("strong",{children:e.username})]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{children:"Mode"})," ",(0,l.jsx)("strong",{children:"manual"===e.freePeriodMode?`Manual (${e.manualFreePeriods})`:"Auto"})]})]}),(0,l.jsxs)("div",{className:"mobile-card-actions",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>el(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>er(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})]},e.id))})]}),(0,l.jsx)("button",{className:"btn btn-success btn-sm",onClick:()=>{w(!0),ei()},style:{marginTop:"15px"},children:"Add Staff"})]}),D&&(0,l.jsxs)("div",{className:"card",ref:U,children:[(0,l.jsx)("h3",{children:W.id?"Edit Staff":"Add New Staff"}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Full Name"}),(0,l.jsx)("input",{type:"text",placeholder:"Dr. John Doe",value:W.name,onChange:e=>z({...W,name:e.target.value})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Username"}),(0,l.jsx)("input",{type:"text",placeholder:"john",value:W.username,onChange:e=>z({...W,username:e.target.value})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:W.id?"New Password (Optional)":"Password"}),(0,l.jsx)("input",{type:"password",placeholder:W.id?"Leave blank to keep current":"Enter password",value:W.password,onChange:e=>z({...W,password:e.target.value})}),W.id&&(0,l.jsx)("small",{style:{color:"#64748b",display:"block",marginTop:"4px"},children:"Staff can use new password immediately on next login"})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Free Period Mode"}),(0,l.jsxs)("select",{value:W.freePeriodMode,onChange:e=>z({...W,freePeriodMode:e.target.value}),children:[(0,l.jsx)("option",{value:"auto",children:"Auto"}),(0,l.jsx)("option",{value:"manual",children:"Manual"})]})]}),"manual"===W.freePeriodMode&&(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Free Periods per Week"}),(0,l.jsx)("input",{type:"number",min:"0",max:"30",value:W.manualFreePeriods,onChange:e=>z({...W,manualFreePeriods:parseInt(e.target.value)||0})})]})]}),(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:ea,children:W.id?"Save Changes":"Add Staff"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{ei(),w(!1)},children:"Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",id:"subject-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“–"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Subjects"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("h3",{children:["Existing Subjects (",y.length,")"]}),0===y.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"No subjects added yet"}):(0,l.jsx)(l.Fragment,{children:t.map(e=>{let s=y.filter(s=>s.className===e.name);if(0===s.length)return null;let t=s.reduce((e,s)=>e+s.hoursPerWeek,0),a=t/30*100;return(0,l.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,l.jsxs)("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",color:"#1e293b",flexWrap:"wrap"},children:[(0,l.jsxs)("h4",{style:{margin:0,display:"flex",alignItems:"center",gap:"8px"},children:["Class ",(0,l.jsx)("strong",{children:e.name})]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px",color:"#64748b",fontWeight:600},children:[(0,l.jsxs)("span",{children:[t,"/30 hours"]}),(0,l.jsxs)("span",{children:[Math.max(30-t,0),"h remaining"]})]})]}),(0,l.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden",marginBottom:"15px"},children:(0,l.jsx)("div",{style:{height:"100%",width:`${Math.min(a,100)}%`,backgroundColor:30===t?"#10b981":"#f59e0b",transition:"width 0.3s ease"}})}),(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Subject"}),(0,l.jsx)("th",{children:"Type"}),(0,l.jsx)("th",{children:"Hours"}),(0,l.jsx)("th",{children:"Teacher"}),(0,l.jsx)("th",{children:"Continuous"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:s.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:(0,l.jsx)("strong",{children:e.name})}),(0,l.jsx)("td",{children:e.subjectType}),(0,l.jsxs)("td",{children:[e.hoursPerWeek,"h"]}),(0,l.jsx)("td",{children:e.teacher}),(0,l.jsx)("td",{children:e.isContinuous?`Yes (${e.blockSize}p)`:"No"}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>ec(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>ed(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]},e.id))})]})}),(0,l.jsx)("div",{className:"mobile-cards",children:s.map(e=>(0,l.jsxs)("div",{className:"mobile-card",children:[(0,l.jsxs)("div",{className:"mobile-card-header",children:[(0,l.jsx)("strong",{children:e.name}),(0,l.jsx)("span",{className:"badge badge-primary",children:e.subjectType})]}),(0,l.jsxs)("div",{className:"mobile-card-body",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{children:"Hours"})," ",(0,l.jsxs)("strong",{children:[e.hoursPerWeek,"h"]})]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{children:"Teacher"})," ",(0,l.jsx)("strong",{children:e.teacher})]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{children:"Continuous"})," ",(0,l.jsx)("strong",{children:e.isContinuous?`Yes (${e.blockSize}p)`:"No"})]})]}),(0,l.jsxs)("div",{className:"mobile-card-actions",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>ec(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>ed(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})]},e.id))})]},e.id)})}),(0,l.jsx)("button",{className:"btn btn-success btn-sm",onClick:()=>{A(!0),eo()},style:{marginTop:"15px"},children:"Add Subject"})]}),k&&(0,l.jsxs)("div",{className:"card",ref:R,children:[(0,l.jsx)("h3",{children:H.id?"Edit Subject":"Add New Subject"}),H.className&&(0,l.jsx)(o.default,{className:H.className,subjects:y}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Select Class"}),(0,l.jsxs)("select",{value:H.className,onChange:e=>Y({...H,className:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"-- Select Class --"}),t.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Subject Name"}),(0,l.jsx)("input",{type:"text",value:H.name,onChange:e=>Y({...H,name:e.target.value}),placeholder:"DBMS, AI Lab, etc."})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Subject Type"}),(0,l.jsxs)("select",{value:H.subjectType,onChange:e=>Y({...H,subjectType:e.target.value}),children:[(0,l.jsx)("option",{value:"Core",children:"Core"}),(0,l.jsx)("option",{value:"Elective",children:"Elective"}),(0,l.jsx)("option",{value:"Lab",children:"Lab"}),(0,l.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Hours per Week"}),(0,l.jsx)("input",{type:"number",min:"1",max:"30",value:H.hoursPerWeek,onChange:e=>Y({...H,hoursPerWeek:parseInt(e.target.value)||6})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Teacher"}),(0,l.jsxs)("select",{value:H.teacher,onChange:e=>Y({...H,teacher:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"-- Select Teacher --"}),G.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))]})]})]}),(0,l.jsxs)("div",{className:"checkbox-group",children:[(0,l.jsx)("input",{type:"checkbox",id:"continuous",checked:H.isContinuous,onChange:e=>Y({...H,isContinuous:e.target.checked})}),(0,l.jsx)("label",{htmlFor:"continuous",style:{marginBottom:0},children:"Continuous Period (Lab)"})]}),H.isContinuous&&(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Block Size"}),(0,l.jsxs)("select",{value:H.blockSize,onChange:e=>Y({...H,blockSize:parseInt(e.target.value)}),children:[(0,l.jsx)("option",{value:"2",children:"2 Periods"}),(0,l.jsx)("option",{value:"3",children:"3 Periods"})]})]}),(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:en,children:H.id?"Save Changes":"Add Subject"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{eo(),A(!1)},children:"Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",id:"generate-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"âš¡"}),(0,l.jsx)("h2",{className:"section-title",children:"Generate Timetable"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Ready to Generate"}),(0,l.jsxs)("div",{className:"stats-grid",children:[(0,l.jsxs)("div",{className:"stat-card stat-primary",children:[(0,l.jsx)("div",{className:"stat-label",children:"Classes"}),(0,l.jsx)("div",{className:"stat-value",children:t.length})]}),(0,l.jsxs)("div",{className:"stat-card stat-success",children:[(0,l.jsx)("div",{className:"stat-label",children:"Teachers"}),(0,l.jsx)("div",{className:"stat-value",children:G.length})]}),(0,l.jsxs)("div",{className:"stat-card stat-warning",children:[(0,l.jsx)("div",{className:"stat-label",children:"Subjects"}),(0,l.jsx)("div",{className:"stat-value",children:y.length})]})]}),(0,l.jsx)("button",{className:"btn btn-success btn-lg",onClick:eh,disabled:T,children:T?"Generating...":"Generate Timetable"})]})]}),N&&(0,l.jsxs)("div",{className:"section",id:"view-timetables",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“Š"}),(0,l.jsx)("h2",{className:"section-title",children:"Generated Timetables"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Class Timetables"}),[...t].sort((e,s)=>e.name.localeCompare(s.name)).filter(e=>N.classTimetables?.[e.name]).map(e=>(0,l.jsxs)("div",{className:"timetable-container",id:`timetable-export-${e.id}`,children:[(0,l.jsx)("h4",{className:"timetable-title",children:e.name}),(0,l.jsx)("div",{className:"timetable-scroll",children:(0,l.jsx)(d.default,{timetable:N.classTimetables,className:e.name})}),(0,l.jsxs)("div",{className:"timetable-actions no-print no-export",children:[(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>(0,m.exportToPDF)(`timetable-export-${e.id}`,`${e.name}_Timetable.pdf`,{title:e.name}),children:"Download PDF"}),(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>{var s;return s=e.name,void M(`Delete timetable for ${s}?`,"This will delete the class timetable and update staff timetables accordingly.",async()=>{try{if(!N||!N.classTimetables||!N.classTimetables[s])return V("Timetable not found","error");let e=N.classTimetables[s],t={type:"classTimetable",className:s,data:e},a={...N.classTimetables};delete a[s];let l=N?.staffTimetables?Object.fromEntries(Object.entries(N.staffTimetables).map(([e,t])=>[e,t.map(e=>e.map(e=>e?.class===s?{subject:"FREE",class:"-",type:"free"}:e))])):null,i=(0,x.collection)(b.db,"timetable"),r=await (0,x.getDocs)(i);r.empty||await (0,x.updateDoc)((0,x.doc)(b.db,"timetable",r.docs[0].id),{classTimetables:K(a),...l?{staffTimetables:J(l)}:{}}),v({...N,classTimetables:a,...l?{staffTimetables:l}:{}}),V(`Timetable for ${s} deleted`,"success",5e3,()=>Q(t))}catch(e){console.error("Delete timetable error:",e),V("Failed to delete timetable","error")}},"danger","Delete")},title:`Delete ${e.name} timetable`,children:"ðŸ—‘ï¸ Delete"})]})]},e.id))]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Staff-wise Timetables"}),[...G].sort((e,s)=>e.name.localeCompare(s.name)).map(e=>(0,l.jsxs)("div",{className:"timetable-container",id:`staff-timetable-export-${e.id}`,children:[(0,l.jsxs)("h4",{className:"timetable-title",children:["Teacher: ",e.name]}),(0,l.jsx)("div",{className:"timetable-scroll",children:(0,l.jsx)(h.default,{timetable:N.staffTimetables,staffName:e.name})}),(0,l.jsx)("div",{className:"timetable-actions no-print no-export",children:(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>(0,m.exportToPDF)(`staff-timetable-export-${e.id}`,`${e.name}_Timetable.pdf`,{title:`Staff Timetable: ${e.name}`}),children:"Download PDF"})})]},e.id))]})]})]}),(0,l.jsx)(c.ToastContainer,{toasts:S,onRemove:q}),(0,l.jsx)(n.default,{isOpen:F.isOpen,title:F.title,message:F.message,onConfirm:F.onConfirm,onClose:()=>{O(e=>({...e,isOpen:!1}))},type:F.type,confirmText:F.confirmText})]})})}}),t("6Eazr",function(t,a){e(t.exports,"default",()=>r);var l=s("ayMG0"),i=s("acw62"),r=({isOpen:e,onClose:s,onConfirm:t,title:a,message:r,confirmText:n="Confirm",cancelText:c="Cancel",type:o="danger"})=>{let[d,h]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{if(e)h(!0),document.body.style.overflow="hidden";else{let e=setTimeout(()=>h(!1),300);return document.body.style.overflow="unset",()=>clearTimeout(e)}},[e]),d||e)?(0,l.jsx)("div",{className:`modal-overlay ${e?"open":"closing"}`,children:(0,l.jsxs)("div",{className:"modal-container",children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsx)("h3",{className:"modal-title",children:a}),(0,l.jsx)("button",{className:"modal-close-btn",onClick:s,children:"Ã—"})]}),(0,l.jsx)("div",{className:"modal-body",children:(0,l.jsx)("p",{children:r})}),(0,l.jsxs)("div",{className:"modal-footer",children:[(0,l.jsx)("button",{className:"btn btn-secondary",onClick:s,children:c}),(0,l.jsx)("button",{className:`btn btn-${o}`,onClick:()=>{t(),s()},children:n})]})]})}):null}}),t("2A5UH",function(t,a){e(t.exports,"ToastContainer",()=>r);var l=s("ayMG0");s("acw62");let i=({id:e,message:s,type:t,onRemove:a,undoAction:i})=>(0,l.jsxs)("div",{style:{padding:"12px 16px",borderRadius:"8px",marginBottom:"10px",background:"error"===t?"#ff4444":"success"===t?"#00C851":"#ffbb33",color:"white",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",animation:"slideIn 0.3s ease-out"},children:[(0,l.jsx)("span",{children:s}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",marginLeft:"16px"},children:[i&&(0,l.jsx)("button",{onClick:()=>{"function"==typeof i&&i(),"function"==typeof a&&a(e)},style:{background:"white",color:"success"===t?"#00C851":"#333",border:"none",padding:"4px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"13px",fontWeight:"600"},children:"UNDO"}),(0,l.jsx)("button",{onClick:()=>{"function"==typeof a&&a(e)},style:{background:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"18px",padding:"0 4px",lineHeight:"1"},title:"Close",children:"Ã—"})]})]}),r=({toasts:e,onRemove:s})=>(0,l.jsx)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,minWidth:"300px",maxWidth:"500px"},children:e.map(e=>(0,l.jsx)(i,{id:e.id,message:e.message,type:e.type,onRemove:s,undoAction:e.undoAction},e.id))})}),t("4XiCD",function(t,a){e(t.exports,"default",()=>i);var l=s("ayMG0");function i({timetable:e,staff:s}){if(!e||!e.staffTimetables)return null;let t=s.filter(e=>"staff"===e.role);return(0,l.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,l.jsx)("h3",{style:{marginBottom:"15px"},children:"ðŸ“Š Staff Hours Summary"}),(0,l.jsxs)("table",{className:"data-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Staff Name"}),(0,l.jsx)("th",{children:"Teaching Hours"}),(0,l.jsx)("th",{children:"Free Periods"}),(0,l.jsx)("th",{children:"Status"})]})}),(0,l.jsx)("tbody",{children:t.map(s=>{let t=e.staffTimetables[s.name];if(!t)return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:s.name}),(0,l.jsx)("td",{children:"0"}),(0,l.jsx)("td",{children:"30"}),(0,l.jsx)("td",{children:"âš ï¸ Not Assigned"})]},s.id);let a=0,i=0;t.forEach(e=>{e.forEach(e=>{e&&"free"!==e.type?a++:i++})});let r=a>=24?"âœ… Full Load":a>=18?"âš¡ Good":a>0?"âš ï¸ Low Load":"âŒ No Classes";return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:s.name}),(0,l.jsxs)("td",{children:[a,"/30"]}),(0,l.jsxs)("td",{children:[i,"/30"]}),(0,l.jsx)("td",{children:r})]},s.id)})})]})]})}s("acw62")}),t("e3nvF",function(t,a){e(t.exports,"default",()=>n);var l=s("ayMG0"),i=s("acw62");let r=["Monday","Tuesday","Wednesday","Thursday","Friday"];function n({timetable:e,className:s}){if(!e||!e[s])return(0,l.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#64748b"},children:"No timetable available"});let t=e[s];return(console.log("TimetableGrid - className:",s),console.log("TimetableGrid - grid:",t),console.log("TimetableGrid - grid is array?",Array.isArray(t)),Array.isArray(t)&&0!==t.length)?(0,l.jsxs)("div",{id:"timetable-export",className:"timetable-grid",children:[(0,l.jsx)("div",{className:"timetable-header",children:"Day/Period"}),[...Array(6)].map((e,s)=>(0,l.jsxs)("div",{className:"timetable-header",children:["P",s+1]},s)),r.map((e,s)=>t[s]&&Array.isArray(t[s])?(0,l.jsxs)((i&&i.__esModule?i.default:i).Fragment,{children:[(0,l.jsx)("div",{className:"timetable-day",children:e}),t[s].map((e,s)=>(0,l.jsx)("div",{className:`timetable-cell subject-${e&&e.type?e.type.toLowerCase():"free"}`,children:e&&"FREE"!==e.subject?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"subject-name",children:e.subject}),(0,l.jsx)("div",{className:"teacher-name",children:e.teacher})]}):(0,l.jsx)("div",{style:{color:"#94a3b8"},children:"FREE"})},s))]},e):null)]}):(0,l.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#64748b"},children:"Invalid timetable format"})}}),t("hyYFF",function(t,a){e(t.exports,"default",()=>i);var l=s("ayMG0");function i({timetable:e,staffName:s}){let t=["P1","P2","P3","P4","P5","P6"],a=e[s];return(console.log("StaffTimetableGrid - Staff:",s),console.log("StaffTimetableGrid - Available:",Object.keys(e)),a)?(0,l.jsx)("div",{className:"timetable-container",id:"staff-timetable-export",children:(0,l.jsxs)("table",{className:"timetable",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"day-header",children:"DAY/PERIOD"}),t.map(e=>(0,l.jsx)("th",{className:"period-header",children:e},e))]})}),(0,l.jsx)("tbody",{children:["Monday","Tuesday","Wednesday","Thursday","Friday"].map((e,s)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"day-cell",children:e}),t.map((e,t)=>{let i=a[s]?.[t],r=!i||"free"===i.type||"FREE"===i.subject;return(0,l.jsx)("td",{className:`period-cell ${r?"free-period":"class-period"}`,children:r?(0,l.jsx)("div",{className:"period-content free",children:(0,l.jsx)("span",{className:"subject-name",children:"FREE"})}):(0,l.jsxs)("div",{className:"period-content",children:[(0,l.jsx)("span",{className:"subject-name",children:i.subject}),(0,l.jsx)("span",{className:"class-name",children:i.class})]})},e)})]},e))})]})}):(0,l.jsxs)("div",{style:{padding:"40px",textAlign:"center"},children:[(0,l.jsx)("div",{style:{fontSize:"48px",marginBottom:"20px"},children:"âš ï¸"}),(0,l.jsx)("h3",{children:"No Timetable Found"}),(0,l.jsxs)("p",{style:{color:"#64748b"},children:['No timetable for "',s,'"']}),(0,l.jsxs)("p",{style:{color:"#64748b",fontSize:"14px"},children:["Available: ",Object.keys(e).join(", ")]})]})}s("acw62")}),t("bU9CP",function(s,t){e(s.exports,"TimetableGenerator",()=>a);class a{constructor(e,s,t){this.classes=e||[],this.staff=s||[],this.subjects=t||[],this.classTimetables={},this.staffTimetables={},this.teacherSlots={},this.DAYS=["Monday","Tuesday","Wednesday","Thursday","Friday"],this.PERIODS=6,this.TOTAL_HOURS=30,this.MAX_TEACHER_HOURS=30,this.globalLabDayCount={},this._seed=Date.now(),this.maxRetries=10}_random(){return this._seed=(1664525*this._seed+0x3c6ef35f)%0x100000000,this._seed/0x100000000}_shuffle(e){let s=[...e];for(let e=s.length-1;e>0;e--){let t=Math.floor(this._random()*(e+1));[s[e],s[t]]=[s[t],s[e]]}return s}_pickRandomFromTopN(e,s=5){if(!e.length)return null;let t=e.slice(0,Math.min(s,e.length));return t[Math.floor(this._random()*t.length)]}_getBaseSubjectName(e=""){return e.replace(/\s+lab$/i,"").trim().toLowerCase()}_isSameBase(e="",s=""){return this._getBaseSubjectName(e)===this._getBaseSubjectName(s)}_zone(e){return e<=1?"Early":e<=3?"Mid":"Late"}validate(){let e=[];for(let s of(this.classes.length||e.push("No classes defined"),this.staff.filter(e=>e?.role==="staff").length||e.push("No staff defined"),this.subjects.length||e.push("No subjects defined"),this.classes)){let t=this.subjects.filter(e=>e?.className===s.name).reduce((e,s)=>e+(s.hoursPerWeek||0),0);t!==this.TOTAL_HOURS&&e.push(`Class "${s.name}": total hours ${t} != required ${this.TOTAL_HOURS}`)}let s={};for(let e of this.subjects)e.teacher&&"-"!==e.teacher&&(s[e.teacher]=(s[e.teacher]||0)+(e.hoursPerWeek||0));for(let[t,a]of Object.entries(s))a>this.MAX_TEACHER_HOURS&&e.push(`Teacher "${t}" overload: ${a}h > ${this.MAX_TEACHER_HOURS}h`);return e.length?{valid:!1,errors:e}:{valid:!0}}_getClassComplexity(e){let s=this.subjects.filter(s=>s.className===e);return 10*s.filter(e=>e.isContinuous).length+5*new Set(s.map(e=>e.teacher)).size+s.length}generate(){console.log("TimetableGenerator: start generate (PRACTICAL MODE)");let e=this.validate();if(!e.valid)return console.error("Validation failed:",e.errors),{success:!1,error:e.errors.join("; ")};for(let e=0;e<this.maxRetries;e++){console.log(`Generation attempt ${e+1}/${this.maxRetries}`),this._seed=Date.now()+1e3*e,this.classTimetables={},this.teacherSlots={},this.globalLabDayCount={},this.classes.forEach(e=>this.classTimetables[e.name]=this.DAYS.map(()=>Array(this.PERIODS).fill(null))),this.staff.forEach(e=>this.teacherSlots[e.name]={}),this.DAYS.forEach(e=>this.globalLabDayCount[e]=0);let s=[...this.classes].sort((e,s)=>this._getClassComplexity(s.name)-this._getClassComplexity(e.name)),t=!0;for(let a of s)if(console.log("Generating for class",a.name),!this._generateForClass(a.name)){console.error(`Failed to generate for class ${a.name} (attempt ${e+1})`),t=!1;break}if(t)return this._buildStaffTimetables(),this._validateTeacherConflicts(),console.log("âœ“ Generation successful!"),{success:!0,classTimetables:this.classTimetables,staffTimetables:this.staffTimetables}}return console.error("Failed to generate timetable after all attempts"),{success:!1,error:"Unable to generate valid timetable after multiple attempts"}}_buildStaffTimetables(){for(let e of(this.staffTimetables={},this.staff))e?.name&&(this.staffTimetables[e.name]=this.DAYS.map(()=>Array(this.PERIODS).fill({subject:"FREE",class:"-",type:"free"})));for(let[e,s]of Object.entries(this.classTimetables))s.forEach((s,t)=>{s.forEach((s,a)=>{s&&s.teacher&&"-"!==s.teacher&&this.staffTimetables[s.teacher]&&(this.staffTimetables[s.teacher][t][a]={subject:s.subject,class:e,type:s.type||"core"})})})}_validateTeacherConflicts(){let e=0;for(let[s,t]of Object.entries(this.teacherSlots)){let a={};for(let l of Object.keys(t))a[l]=(a[l]||0)+1,a[l]>1&&(console.error(`Teacher conflict: ${s} at ${l}`),e++)}e||console.log("No teacher conflicts")}_generateForClass(e){let s=this.subjects.filter(s=>s.className===e);if(!s.length)return!0;let t=s.filter(e=>!!e.isContinuous),a=s.filter(e=>!e.isContinuous),l=this.classTimetables[e],i={daysUsed:{},dayPeriodMap:{},periodWeeklyCount:{},zonesUsed:{},hoursPlaced:{},lastPeriod:{},subjectBaseDays:{}};for(let e of a){i.daysUsed[e.name]=new Set,i.dayPeriodMap[e.name]={},i.periodWeeklyCount[e.name]=Array(this.PERIODS).fill(0),i.zonesUsed[e.name]=new Set,i.hoursPlaced[e.name]=0,i.lastPeriod[e.name]=-1;let s=this._getBaseSubjectName(e.name);i.subjectBaseDays[s]=i.subjectBaseDays[s]||new Set}let r={daysUsedByLab:{},periodsUsedByLab:{},blockUsageCount:{},hoursPlaced:{},lastDayIdx:{}},n={};for(let e=0;e<this.DAYS.length;e++)n[e]=0;for(let e of t)r.daysUsedByLab[e.name]=new Set,r.periodsUsedByLab[e.name]=new Set,r.blockUsageCount[e.name]={},r.hoursPlaced[e.name]=0,r.lastDayIdx[e.name]=-1;for(let s of t){let t=s.hoursPerWeek||0,a=Math.floor(t/2);for(let t=0;t<a;t++){if(!this._placeLabBlock_withMaxPerDay(e,s,l,r,n))return console.error(`Impossible to place lab block for ${s.name} in class ${e}`),!1;r.hoursPlaced[s.name]+=2}t%2==1&&this._placeLabSingle_withMaxPerDay(e,s,l,r,n)&&(r.hoursPlaced[s.name]+=1)}let c=a.filter(e=>(e.hoursPerWeek||0)>=5),o=a.filter(e=>5>(e.hoursPerWeek||0));for(let s of c)for(let t=0;t<this.DAYS.length&&!(i.hoursPlaced[s.name]>=s.hoursPerWeek);t++)this._placeTheoryFlexible(e,s,l,i,r,t)&&(i.hoursPlaced[s.name]+=1);for(let s of[...o].sort((e,s)=>(e.hoursPerWeek||0)-(s.hoursPerWeek||0))){let t=0;for(;i.hoursPlaced[s.name]<(s.hoursPerWeek||0)&&t<100;)this._placeTheoryFlexible(e,s,l,i,r)?i.hoursPlaced[s.name]++:t++}for(let s of[...c,...o]){let t=0;for(;i.hoursPlaced[s.name]<(s.hoursPerWeek||0)&&t<300;)this._placeTheoryFlexible(e,s,l,i,r)||this._placeTheoryAny(e,s,l,i,r)?i.hoursPlaced[s.name]++:t++;for(;i.hoursPlaced[s.name]<(s.hoursPerWeek||0);){if(!this._placeTheoryAny(e,s,l,i,r))return console.error(`FAILED: Cannot place ${s.name} in ${e}`),!1;i.hoursPlaced[s.name]++}}let d=this._countPlacedHours(e);return d===this.TOTAL_HOURS||(console.error(`Class ${e} final hours ${d} != ${this.TOTAL_HOURS}`),!1)}_countPlacedHours(e){let s=this.classTimetables[e],t=0;for(let e=0;e<this.DAYS.length;e++)for(let a=0;a<this.PERIODS;a++)s[e][a]&&t++;return t}_placeLabBlock_withMaxPerDay(e,s,t,a,l){let i=s.teacher,r=[];for(let e of this._shuffle([0,1,2,3,4]))if(!((l[e]||0)>=2))for(let l of this._shuffle([0,1,2,3,4])){if(l>this.PERIODS-2||t[e][l]||t[e][l+1])continue;let n=`${this.DAYS[e]}-P${l+1}`,c=`${this.DAYS[e]}-P${l+2}`;if(this.teacherSlots[i]?.[n]||this.teacherSlots[i]?.[c]||a.daysUsedByLab[s.name].has(e))continue;let o=100;a.daysUsedByLab[s.name].has(e)||(o+=80);let d=`P${l+1}-P${l+2}`,h=a.blockUsageCount[s.name][d]||0;0===h?o+=60:o-=50*h,r.push({dayIdx:e,startP:l,score:o,blockKey:d})}if(!r.length)return!1;r.sort((e,s)=>s.score-e.score);let n=this._pickRandomFromTopN(r,6);if(!n)return!1;t[n.dayIdx][n.startP]={subject:s.name,teacher:i,type:s.subjectType||"lab",isLab:!0},t[n.dayIdx][n.startP+1]={subject:s.name,teacher:i,type:s.subjectType||"lab",isLab:!0,isLabContinuation:!0};let c=`${this.DAYS[n.dayIdx]}-P${n.startP+1}`,o=`${this.DAYS[n.dayIdx]}-P${n.startP+2}`;return this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i][c]=e,this.teacherSlots[i][o]=e,a.daysUsedByLab[s.name].add(n.dayIdx),a.periodsUsedByLab[s.name].add(n.startP),a.blockUsageCount[s.name][n.blockKey]=(a.blockUsageCount[s.name][n.blockKey]||0)+1,a.lastDayIdx[s.name]=n.dayIdx,l[n.dayIdx]=(l[n.dayIdx]||0)+2,this.globalLabDayCount[this.DAYS[n.dayIdx]]=(this.globalLabDayCount[this.DAYS[n.dayIdx]]||0)+1,!0}_placeLabSingle_withMaxPerDay(e,s,t,a,l){let i=s.teacher,r=[];for(let e of this._shuffle([0,1,2,3,4]))if(!((l[e]||0)+1>2))for(let l of this._shuffle([0,1,2,3,4,5])){if(t[e][l])continue;let n=`${this.DAYS[e]}-P${l+1}`;if(this.teacherSlots[i]?.[n]||a.daysUsedByLab[s.name].has(e))continue;let c=80;a.daysUsedByLab[s.name].has(e)||(c+=40),r.push({dayIdx:e,p:l,score:c})}if(!r.length)return!1;r.sort((e,s)=>s.score-e.score);let n=this._pickRandomFromTopN(r,6);if(!n)return!1;t[n.dayIdx][n.p]={subject:s.name,teacher:i,type:s.subjectType||"lab",isLab:!0,isLabSingle:!0};let c=`${this.DAYS[n.dayIdx]}-P${n.p+1}`;return this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i][c]=e,a.daysUsedByLab[s.name].add(n.dayIdx),a.periodsUsedByLab[s.name].add(n.p),l[n.dayIdx]=(l[n.dayIdx]||0)+1,this.globalLabDayCount[this.DAYS[n.dayIdx]]=(this.globalLabDayCount[this.DAYS[n.dayIdx]]||0)+1,!0}_placeTheoryFlexible(e,s,t,a,l,i=null){let r=s.teacher,n=[];for(let e of null!==i?[i]:this._shuffle([0,1,2,3,4]))for(let l of this._shuffle([0,1,2,3,4,5])){if(t[e][l])continue;let i=`${this.DAYS[e]}-P${l+1}`;if(this.teacherSlots[r]?.[i]||l>0&&t[e][l-1]&&this._isSameBase(t[e][l-1].subject,s.name)||l<this.PERIODS-1&&t[e][l+1]&&this._isSameBase(t[e][l+1].subject,s.name))continue;let c=100,o=a.periodWeeklyCount[s.name][l]||0;0===o?c+=80:1===o?c-=20:2===o?c-=40:c-=60,a.daysUsed[s.name].has(e)||(c+=30);let d=this._zone(l);a.zonesUsed[s.name].has(d)||(c+=20),e>0&&a.dayPeriodMap[s.name]?.[e-1]===l&&(c-=15);let h=a.dayPeriodMap[s.name]?.[e-1];null!=h&&(l===h-1||l===h+1)&&(c-=10),n.push({dayIdx:e,p:l,score:c})}if(!n.length)return!1;n.sort((e,s)=>s.score-e.score);let c=this._pickRandomFromTopN(n,8);if(!c)return!1;t[c.dayIdx][c.p]={subject:s.name,teacher:r,type:s.subjectType||"core"};let o=`${this.DAYS[c.dayIdx]}-P${c.p+1}`;return this.teacherSlots[r]||(this.teacherSlots[r]={}),this.teacherSlots[r][o]=e,a.daysUsed[s.name].add(c.dayIdx),a.dayPeriodMap[s.name][c.dayIdx]=c.p,a.periodWeeklyCount[s.name][c.p]=(a.periodWeeklyCount[s.name][c.p]||0)+1,a.zonesUsed[s.name].add(this._zone(c.p)),a.lastPeriod[s.name]=c.p,a.subjectBaseDays[this._getBaseSubjectName(s.name)].add(c.dayIdx),!0}_placeTheoryAny(e,s,t,a,l){let i=s.teacher;for(let l=0;l<5;l++)for(let r=0;r<this.PERIODS;r++){if(t[l][r])continue;let n=`${this.DAYS[l]}-P${r+1}`;if(!(this.teacherSlots[i]?.[n]||r>0&&t[l][r-1]&&this._isSameBase(t[l][r-1].subject,s.name))&&!(r<this.PERIODS-1&&t[l][r+1]&&this._isSameBase(t[l][r+1].subject,s.name)))return t[l][r]={subject:s.name,teacher:i,type:s.subjectType||"core"},this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i][n]=e,a.daysUsed[s.name].add(l),a.dayPeriodMap[s.name][l]=r,a.periodWeeklyCount[s.name][r]=(a.periodWeeklyCount[s.name][r]||0)+1,a.zonesUsed[s.name].add(this._zone(r)),a.lastPeriod[s.name]=r,a.subjectBaseDays[this._getBaseSubjectName(s.name)].add(l),!0}for(let l=0;l<5;l++)for(let r=0;r<this.PERIODS;r++){if(t[l][r])continue;let n=`${this.DAYS[l]}-P${r+1}`;if(!this.teacherSlots[i]?.[n])return t[l][r]={subject:s.name,teacher:i,type:s.subjectType||"core"},this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i][n]=e,a.daysUsed[s.name].add(l),a.dayPeriodMap[s.name][l]=r,a.periodWeeklyCount[s.name][r]=(a.periodWeeklyCount[s.name][r]||0)+1,a.zonesUsed[s.name].add(this._zone(r)),a.lastPeriod[s.name]=r,a.subjectBaseDays[this._getBaseSubjectName(s.name)].add(l),!0}return!1}}});
//# sourceMappingURL=AdminDashboard.5345c2be.js.map

function e(e,s,a,t){Object.defineProperty(e,s,{get:a,set:t,enumerable:!0,configurable:!0})}var s=globalThis.parcelRequireb79f,a=s.register;a("dXtBz",function(a,t){Object.defineProperty(a.exports,"__esModule",{value:!0,configurable:!0}),e(a.exports,"default",()=>j);var l=s("ayMG0"),r=s("acw62"),i=s("aOD4d"),n=s("2A5UH"),c=s("4XiCD"),d=s("e3nvF"),o=s("hyYFF"),h=s("gqAsg"),m=s("bU9CP"),u=s("fAZ67"),b=s("6AR8M"),x=s("ilpIi");function j({user:e,onLogout:s}){let a,t,j,[f,p]=(0,r.useState)([]),[y,g]=(0,r.useState)([]),[N,v]=(0,r.useState)([]),[C,P]=(0,r.useState)(null),[S,T]=(0,r.useState)([]),[w,k]=(0,r.useState)(!0),[D,E]=(0,r.useState)(!1),[A,F]=(0,r.useState)(!1),[$,I]=(0,r.useState)(!1),[M,O]=(0,r.useState)("classes"),R=(0,r.useRef)(null),W=(0,r.useRef)(null),[_,U]=(0,r.useState)({name:"",hallNumber:""}),[L,G]=(0,r.useState)({id:null,name:"",username:"",password:"",freePeriodMode:"auto",manualFreePeriods:0}),[B,z]=(0,r.useState)({id:null,className:"",name:"",subjectType:"Core",hoursPerWeek:6,isContinuous:!1,blockSize:2,teacher:""}),H=y.filter(e=>"staff"===e.role),Y=(e,s,a=3e3,t=null)=>{let l={message:e,type:s,id:Date.now(),undoAction:t};T(e=>[...e,l]),setTimeout(()=>V(l.id),a)},V=e=>{T(s=>s.filter(s=>s.id!==e))},q=e=>{if(!e)return null;let s={};return Object.keys(e).forEach(a=>{let t=e[a];if(Array.isArray(t)&&t.length>0&&Array.isArray(t[0]))s[a]=t;else if(Array.isArray(t)){let e=[[],[],[],[],[]];t.forEach(s=>{s&&"number"==typeof s.day&&"number"==typeof s.period&&(e[s.day]||(e[s.day]=[]),e[s.day][s.period]={subject:s.subject,teacher:s.teacher,class:s.class,type:s.type})}),e.forEach((s,a)=>{e[a]||(e[a]=[]);for(let s=0;s<6;s++)e[a][s]||(e[a][s]=t[0]?.class!==void 0?{subject:"FREE",class:"-",type:"free"}:null)}),s[a]=e}}),s},X=async()=>{k(!0);try{let[e,s,a,t]=await Promise.all([(0,x.getDocs)((0,x.collection)(u.db,"classes")),(0,x.getDocs)((0,x.collection)(u.db,"staff")),(0,x.getDocs)((0,x.collection)(u.db,"subjects")),(0,x.getDocs)((0,x.collection)(u.db,"timetable"))]);if(p(e.docs.map(e=>({id:e.id,...e.data()}))),g(s.docs.map(e=>({id:e.id,...e.data()}))),v(a.docs.map(e=>({id:e.id,...e.data()}))),!t.empty){let e=t.docs[0].data(),s={classTimetables:q(e.classTimetables),staffTimetables:q(e.staffTimetables)};P(s)}}catch(e){Y("âŒ Error loading data: "+e.message,"error"),console.error(e)}k(!1)};(0,r.useEffect)(()=>{X()},[]);let J=async e=>{try{if("class"===e.type){let{id:s,...a}=e.data;await (0,x.setDoc)((0,x.doc)(u.db,"classes",s),a)}else if("staff"===e.type){let{id:s,...a}=e.data;await (0,x.setDoc)((0,x.doc)(u.db,"staff",s),a),e.data.firebaseUid&&await (0,x.setDoc)((0,x.doc)(u.db,"users",e.data.firebaseUid),{name:e.data.name,username:e.data.username,role:"staff"})}else if("subject"===e.type){let{id:s,...a}=e.data;await (0,x.setDoc)((0,x.doc)(u.db,"subjects",s),a)}await X(),Y("âœ… Data restored!","success")}catch(e){console.error("Restore error:",e),Y("âŒ Restore failed: "+e.message,"error")}},Z=async()=>{if(!_.name)return Y("Enter class name","error");if(f.find(e=>e.name===_.name&&!_.id))return Y("Class already exists","error");try{if(_.id)await (0,x.updateDoc)((0,x.doc)(u.db,"classes",_.id),{name:_.name,hallNumber:_.hallNumber}),p(f.map(e=>e.id===_.id?{id:_.id,..._}:e)),Y("âœ… Class updated!","success");else{let e=await (0,x.addDoc)((0,x.collection)(u.db,"classes"),{name:_.name,hallNumber:_.hallNumber||""});p([...f,{id:e.id,name:_.name,hallNumber:_.hallNumber||""}]),Y("âœ… Class added!","success")}U({name:"",hallNumber:""})}catch(e){Y("âŒ Operation failed","error")}},K=e=>{U({id:e.id,name:e.name,hallNumber:e.hallNumber||""}),window.scrollTo({top:0,behavior:"smooth"})},Q=async e=>{if(window.confirm("Delete this class?"))try{let s=f.find(s=>s.id===e);if(!s)return;let a={type:"class",data:{...s}};await (0,x.deleteDoc)((0,x.doc)(u.db,"classes",e)),p(f.filter(s=>s.id!==e)),Y(`\u{2705} Class deleted`,"success",5e3,()=>J(a))}catch(e){console.error("Delete error:",e),Y("âŒ Failed to delete","error")}},ee=async()=>{if(!L.name||!L.username)return Y("Fill all required fields","error");try{if(L.id){let e=y.find(e=>e.id===L.id),{password:s,...a}=L,t={name:a.name,freePeriodMode:a.freePeriodMode,manualFreePeriods:a.manualFreePeriods};e.username!==a.username&&(t.username=a.username),await (0,x.updateDoc)((0,x.doc)(u.db,"staff",L.id),t),e.firebaseUid&&await (0,x.updateDoc)((0,x.doc)(u.db,"users",e.firebaseUid),{name:L.name,username:L.username,role:"staff"}),s&&s.trim()?(await (0,x.updateDoc)((0,x.doc)(u.db,"staff",L.id),{tempPassword:s,passwordLastChanged:new Date().toISOString(),needsPasswordChange:!0}),Y("âœ… Temporary password set. Share it with staff.","success")):Y("âœ… Staff updated!","success"),g(y.map(e=>e.id===L.id?{...e,...t}:e)),ea(),E(!1);return}if(!L.password)return Y("Password required","error");let e=`${L.username}@timetable.com`,s=(await (0,b.createUserWithEmailAndPassword)(u.auth,e,L.password)).user.uid,a={name:L.name,username:L.username,freePeriodMode:L.freePeriodMode,manualFreePeriods:L.manualFreePeriods,role:"staff",firebaseUid:s},t=await (0,x.addDoc)((0,x.collection)(u.db,"staff"),a);await (0,x.setDoc)((0,x.doc)(u.db,"users",s),{name:L.name,username:L.username,role:"staff"}),g([...y,{id:t.id,...a}]),ea(),E(!1),Y("âœ… Staff added!","success")}catch(e){Y("âŒ Operation failed: "+e.message,"error"),console.error(e)}},es=e=>{G({...e,password:""}),E(!0),setTimeout(()=>{R.current?.scrollIntoView({behavior:"smooth",block:"center"})},100)},ea=()=>{G({id:null,name:"",username:"",password:"",freePeriodMode:"auto",manualFreePeriods:0})},et=async e=>{if(window.confirm("Delete this staff member?"))try{let s=y.find(s=>s.id===e);if(!s)return;let a={type:"staff",data:{...s}};await (0,x.deleteDoc)((0,x.doc)(u.db,"staff",e)),s.firebaseUid&&await (0,x.deleteDoc)((0,x.doc)(u.db,"users",s.firebaseUid)),g(y.filter(s=>s.id!==e)),Y("âœ… Staff deleted","success",5e3,()=>J(a))}catch(e){console.error("Delete staff error:",e),Y("âŒ Failed to delete","error")}},el=async()=>{if(!B.className||!B.name||!B.teacher)return Y("Fill all required fields","error");try{let e={className:B.className,name:B.name,subjectType:B.subjectType,hoursPerWeek:B.hoursPerWeek,isContinuous:B.isContinuous,blockSize:B.blockSize,teacher:B.teacher};if(B.id)await (0,x.updateDoc)((0,x.doc)(u.db,"subjects",B.id),e),v(N.map(s=>s.id===B.id?{id:B.id,...e}:s)),Y("âœ… Subject updated!","success");else{let s=await (0,x.addDoc)((0,x.collection)(u.db,"subjects"),e);v([...N,{id:s.id,...e}]),Y("âœ… Subject added!","success")}ei(),F(!1)}catch(e){Y("âŒ Operation failed","error"),console.error(e)}},er=e=>{z({id:e.id,className:e.className,name:e.name,subjectType:e.subjectType,hoursPerWeek:e.hoursPerWeek,isContinuous:e.isContinuous||!1,blockSize:e.blockSize||2,teacher:e.teacher}),F(!0),setTimeout(()=>{W.current?.scrollIntoView({behavior:"smooth",block:"center"})},100)},ei=()=>{z({id:null,className:"",name:"",subjectType:"Core",hoursPerWeek:6,isContinuous:!1,blockSize:2,teacher:""})},en=async e=>{if(window.confirm("Delete this subject?"))try{let s=N.find(s=>s.id===e);if(!s)return;let a={type:"subject",data:{...s}};await (0,x.deleteDoc)((0,x.doc)(u.db,"subjects",e)),v(N.filter(s=>s.id!==e)),Y("âœ… Subject deleted","success",5e3,()=>J(a))}catch(e){console.error("Delete subject error:",e),Y("âŒ Failed to delete","error")}},ec=async()=>{k(!0);try{let e=new(0,m.TimetableGenerator)(f,y.filter(e=>"staff"===e.role),N),s=e.validate();if(!s.valid){Y("âŒ Validation: "+s.errors[0],"error"),k(!1);return}let a=e.generate();if(a.success){let e={},s={};Object.keys(a.classTimetables).forEach(s=>{e[s]=a.classTimetables[s].map((e,s)=>e.map((e,a)=>({day:s,period:a,subject:e?.subject||null,teacher:e?.teacher||null,type:e?.type||null}))).flat()}),Object.keys(a.staffTimetables).forEach(e=>{s[e]=a.staffTimetables[e].map((e,s)=>e.map((e,a)=>({day:s,period:a,subject:e?.subject||null,class:e?.class||null,type:e?.type||null}))).flat()});let t={classTimetables:e,staffTimetables:s,generatedAt:new Date().toISOString()},l=(0,x.collection)(u.db,"timetable"),r=await (0,x.getDocs)(l);for(let e of(r.empty?await (0,x.addDoc)(l,t):await (0,x.updateDoc)((0,x.doc)(u.db,"timetable",r.docs[0].id),t),y.filter(e=>"staff"===e.role))){let a=s[e.name];a&&await (0,x.setDoc)((0,x.doc)(u.db,"staffTimetables",e.id),{staffName:e.name,timetable:a,generatedAt:new Date().toISOString()})}let i={};Object.keys(e).forEach(s=>{let a=[[],[],[],[],[]];e[s].forEach(e=>{a[e.day]||(a[e.day]=[]),a[e.day][e.period]={subject:e.subject,teacher:e.teacher,type:e.type}}),a.forEach((e,s)=>{a[s]||(a[s]=[]);for(let e=0;e<6;e++)a[s][e]||(a[s][e]=null)}),i[s]=a});let n={};Object.keys(s).forEach(e=>{let a=[[],[],[],[],[]];s[e].forEach(e=>{a[e.day]||(a[e.day]=[]),a[e.day][e.period]={subject:e.subject,class:e.class,type:e.type}}),a.forEach((e,s)=>{a[s]||(a[s]=[]);for(let e=0;e<6;e++)a[s][e]||(a[s][e]={subject:"FREE",class:"-",type:"free"})}),n[e]=a}),P({classTimetables:i,staffTimetables:n}),Y("âœ… Timetable generated & saved!","success"),setTimeout(()=>{document.getElementById("view-timetables")?.scrollIntoView({behavior:"smooth"})},1e3)}else Y("âŒ Failed: "+a.error,"error")}catch(e){Y("âŒ Error: "+e.message,"error"),console.error(e)}k(!1)};return w?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.default,{}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",color:"white",fontSize:"24px",gap:"20px"},children:[(0,l.jsx)("div",{className:"spinner"}),(0,l.jsx)("div",{children:"Loading..."})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.default,{forceFull:!0}),(0,l.jsxs)("div",{className:"min-h-screen relative z-10 text-white",children:[(0,l.jsxs)("div",{className:"header-content",children:[(0,l.jsx)("h1",{children:"ðŸ« Admin Dashboard"}),(0,l.jsx)("div",{className:"header-actions",children:(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:s,children:"Logout"})})]}),(0,l.jsxs)("div",{className:"segmented-nav",children:[(0,l.jsx)("button",{className:`segmented-item ${"classes"===M?"active":""}`,onClick:()=>{O("classes"),document.getElementById("classes-section")?.scrollIntoView({behavior:"smooth"})},title:"Classes",children:"ðŸŽ“ Classes"}),(0,l.jsx)("button",{className:`segmented-item ${"staff"===M?"active":""}`,onClick:()=>{O("staff"),document.getElementById("staff-section")?.scrollIntoView({behavior:"smooth"})},title:"Staff",children:"ðŸ‘¥ Staff"}),(0,l.jsx)("button",{className:`segmented-item ${"subjects"===M?"active":""}`,onClick:()=>{O("subjects"),document.getElementById("subject-section")?.scrollIntoView({behavior:"smooth"})},title:"Subjects",children:"ðŸ“– Subjects"}),(0,l.jsx)("button",{className:`segmented-item ${"generate"===M?"active":""}`,onClick:()=>{O("generate"),document.getElementById("generate-section")?.scrollIntoView({behavior:"smooth"})},title:"Generate",children:"ðŸ”„ Generate"}),(0,l.jsx)("button",{className:`segmented-item ${"results"===M?"active":""}`,onClick:()=>{O("results"),document.getElementById("view-timetables")?.scrollIntoView({behavior:"smooth"})},title:"Results",children:"ðŸ“… Results"})]})]}),(0,l.jsxs)("div",{className:"content",children:[(0,l.jsxs)("div",{className:"section",id:"classes-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“š"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Classes"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("h3",{children:["Existing Classes (",f.length,")"]}),0===f.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"No classes added yet"}):(0,l.jsxs)(l.Fragment,{children:[(a=[...f].sort((e,s)=>e.name.localeCompare(s.name))).map((e,s)=>(0,l.jsxs)("div",{className:"dept-group",children:[a[s]&&(0,l.jsx)("div",{className:"dept-chip",children:"Class"}),[e].map((e,s)=>{let a=N.filter(s=>s.className===e.name),t=a.reduce((e,s)=>e+s.hoursPerWeek,0),r=t/30*100;return(0,l.jsxs)("div",{className:"class-box",children:[(0,l.jsxs)("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",color:"#1e293b",flexWrap:"wrap"},children:[(0,l.jsxs)("h4",{style:{margin:0,display:"flex",alignItems:"center",gap:"8px"},children:["Class: ",(0,l.jsx)("strong",{children:e.name})]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px",color:"#64748b",fontWeight:600},children:[(0,l.jsxs)("span",{children:[t,"/30 hours"]}),(0,l.jsxs)("span",{children:[Math.max(30-t,0),"h remaining"]})]})]}),(0,l.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden",marginBottom:"15px"},children:(0,l.jsx)("div",{style:{height:"100%",width:`${Math.min(r,100)}%`,backgroundColor:30===t?"#10b981":"#f59e0b",transition:"width 0.3s ease"}})}),(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Hall Number"}),(0,l.jsx)("th",{children:"Subjects"}),(0,l.jsx)("th",{children:"Hours"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.hallNumber||"-"}),(0,l.jsx)("td",{children:a.length}),(0,l.jsx)("td",{children:(0,l.jsxs)("span",{className:`badge ${30===t?"badge-success":"badge-danger"}`,children:[t,"/30h"]})}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>{K(e),I(!0)},title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>Q(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]})})]})})]},`${e.id}-${s}`)})]},`class-${e.id}`)),(0,l.jsx)("div",{className:"mobile-cards",children:(t=[...f].sort((e,s)=>e.name.localeCompare(s.name)),j=[],t.forEach((e,s)=>{let a=N.filter(s=>s.className===e.name),t=a.reduce((e,s)=>e+s.hoursPerWeek,0);j.push((0,l.jsxs)("div",{className:"mobile-card",children:[(0,l.jsxs)("div",{className:"mobile-card-header",children:[(0,l.jsx)("span",{className:"mobile-card-title",children:e.name}),(0,l.jsxs)("span",{className:"mobile-card-badge",children:["#",s+1]})]}),(0,l.jsxs)("div",{className:"mobile-card-body",children:[(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Hall:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:e.hallNumber||"-"})]}),(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Subjects:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:a.length})]}),(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Hours:"}),(0,l.jsxs)("span",{className:"mobile-card-value",children:[t,"/30h"]})]})]}),(0,l.jsxs)("div",{className:"mobile-card-actions",children:[(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>{K(e),I(!0)},children:"âœï¸ Edit"}),(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>Q(e.id),children:"ðŸ—‘ï¸ Delete"})]})]},e.id))}),j)})]}),(0,l.jsx)("button",{className:"btn btn-success btn-sm",onClick:()=>{I(!0),U({id:null,name:"",hallNumber:""})},style:{marginTop:"15px"},children:"âž• Add Class"})]}),$&&(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:_.id?"âœï¸ Edit Class":"âž• Add New Class"}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Class Name *"}),(0,l.jsx)("input",{type:"text",value:_.name,onChange:e=>U({..._,name:e.target.value.toUpperCase()}),placeholder:"CS3A, EE2B"})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Hall Number (Optional)"}),(0,l.jsx)("input",{type:"text",value:_.hallNumber,onChange:e=>U({..._,hallNumber:e.target.value}),placeholder:"Hall 101"})]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:Z,children:_.id?"ðŸ’¾ Update Class":"âž• Add Class"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{U({name:"",hallNumber:""}),I(!1)},children:"âŒ Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",id:"staff-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ‘¥"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Staff"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("h3",{children:["Existing Staff (",H.length,")"]}),0===H.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"No staff added yet"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"S.No"}),(0,l.jsx)("th",{children:"Name"}),(0,l.jsx)("th",{children:"Username"}),(0,l.jsx)("th",{children:"Free Periods"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:H.map((e,s)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:(0,l.jsxs)("span",{className:"staff-badge",children:["S",s+1]})}),(0,l.jsx)("td",{children:(0,l.jsx)("strong",{children:e.name})}),(0,l.jsx)("td",{children:e.username}),(0,l.jsx)("td",{children:"manual"===e.freePeriodMode?`Manual (${e.manualFreePeriods} free periods)`:"Auto"}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>es(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>et(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]},e.id))})]})}),(0,l.jsx)("div",{className:"mobile-cards",children:H.map((e,s)=>(0,l.jsxs)("div",{className:"mobile-card",children:[(0,l.jsxs)("div",{className:"mobile-card-header",children:[(0,l.jsx)("span",{className:"mobile-card-title",children:e.name}),(0,l.jsxs)("span",{className:"mobile-card-badge",children:["S",s+1]})]}),(0,l.jsxs)("div",{className:"mobile-card-body",children:[(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Username:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:e.username})]}),(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Free Periods:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:"manual"===e.freePeriodMode?`Manual (${e.manualFreePeriods} free periods)`:"Auto"})]})]}),(0,l.jsxs)("div",{className:"mobile-card-actions",children:[(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>es(e),children:"âœï¸ Edit"}),(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>et(e.id),children:"ðŸ—‘ï¸ Delete"})]})]},e.id))})]}),(0,l.jsx)("button",{className:"btn btn-success btn-sm",onClick:()=>{E(!0),ea()},style:{marginTop:"15px"},children:"âž• Add Staff"})]}),D&&(0,l.jsxs)("div",{className:"card",ref:R,children:[(0,l.jsx)("h3",{children:L.id?"âœï¸ Edit Staff":"âž• Add New Staff"}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Full Name *"}),(0,l.jsx)("input",{type:"text",placeholder:"Dr. John Doe",value:L.name,onChange:e=>G({...L,name:e.target.value})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Username *"}),(0,l.jsx)("input",{type:"text",placeholder:"john",value:L.username,onChange:e=>G({...L,username:e.target.value})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsxs)("label",{children:[L.id?"New Password (Optional)":"Password"," *"]}),(0,l.jsx)("input",{type:"password",placeholder:L.id?"Leave blank to keep current":"Enter password",value:L.password,onChange:e=>G({...L,password:e.target.value})}),L.id&&(0,l.jsx)("small",{style:{color:"#64748b",display:"block",marginTop:"4px"},children:"âœ“ Staff can use new password immediately on next login"})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Free Period Mode"}),(0,l.jsxs)("select",{value:L.freePeriodMode,onChange:e=>G({...L,freePeriodMode:e.target.value}),children:[(0,l.jsx)("option",{value:"auto",children:"Auto"}),(0,l.jsx)("option",{value:"manual",children:"Manual"})]})]})]}),"manual"===L.freePeriodMode&&(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Free Periods per Week"}),(0,l.jsx)("input",{type:"number",min:"0",max:"30",value:L.manualFreePeriods,onChange:e=>G({...L,manualFreePeriods:parseInt(e.target.value)||0})})]}),(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:ee,children:L.id?"ðŸ’¾ Save Changes":"âž• Add Staff"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{ea(),E(!1)},children:"âŒ Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",id:"subject-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“–"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Subjects"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("h3",{children:["Existing Subjects (",N.length,")"]}),0===N.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"No subjects added yet"}):(0,l.jsx)(l.Fragment,{children:f.map(e=>{let s=N.filter(s=>s.className===e.name);if(0===s.length)return null;let a=s.reduce((e,s)=>e+s.hoursPerWeek,0),t=a/30*100;return(0,l.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,l.jsxs)("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",color:"#1e293b",flexWrap:"wrap"},children:[(0,l.jsxs)("h4",{style:{margin:0,display:"flex",alignItems:"center",gap:"8px"},children:["Class: ",(0,l.jsx)("strong",{children:e.name})]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px",color:"#64748b",fontWeight:600},children:[(0,l.jsxs)("span",{children:[a,"/30 hours"]}),(0,l.jsxs)("span",{children:[Math.max(30-a,0),"h remaining"]})]})]}),(0,l.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden",marginBottom:"15px"},children:(0,l.jsx)("div",{style:{height:"100%",width:`${Math.min(t,100)}%`,backgroundColor:30===a?"#10b981":"#f59e0b",transition:"width 0.3s ease"}})}),(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Subject"}),(0,l.jsx)("th",{children:"Type"}),(0,l.jsx)("th",{children:"Hours"}),(0,l.jsx)("th",{children:"Teacher"}),(0,l.jsx)("th",{children:"Continuous"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:s.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:(0,l.jsx)("strong",{children:e.name})}),(0,l.jsx)("td",{children:e.subjectType}),(0,l.jsxs)("td",{children:[e.hoursPerWeek,"h"]}),(0,l.jsx)("td",{children:e.teacher}),(0,l.jsx)("td",{children:e.isContinuous?`Yes (${e.blockSize}p)`:"No"}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>er(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>en(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]},e.id))})]})}),(0,l.jsx)("div",{className:"mobile-cards",children:s.map(e=>(0,l.jsxs)("div",{className:"mobile-card",children:[(0,l.jsxs)("div",{className:"mobile-card-header",children:[(0,l.jsx)("span",{className:"mobile-card-title",children:e.name}),(0,l.jsx)("span",{className:"mobile-card-badge",children:e.subjectType})]}),(0,l.jsxs)("div",{className:"mobile-card-body",children:[(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Hours:"}),(0,l.jsxs)("span",{className:"mobile-card-value",children:[e.hoursPerWeek,"h"]})]}),(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Teacher:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:e.teacher})]}),(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Continuous:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:e.isContinuous?`Yes (${e.blockSize}p)`:"No"})]})]}),(0,l.jsxs)("div",{className:"mobile-card-actions",children:[(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>er(e),children:"âœï¸ Edit"}),(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>en(e.id),children:"ðŸ—‘ï¸ Delete"})]})]},e.id))})]},e.id)})}),(0,l.jsx)("button",{className:"btn btn-success btn-sm",onClick:()=>{F(!0),ei()},style:{marginTop:"15px"},children:"âž• Add Subject"})]}),A&&(0,l.jsxs)("div",{className:"card",ref:W,children:[(0,l.jsx)("h3",{children:B.id?"âœï¸ Edit Subject":"âž• Add New Subject"}),B.className&&(0,l.jsx)(c.default,{className:B.className,subjects:N}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Select Class *"}),(0,l.jsxs)("select",{value:B.className,onChange:e=>z({...B,className:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"-- Select Class --"}),f.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Subject Name *"}),(0,l.jsx)("input",{type:"text",value:B.name,onChange:e=>z({...B,name:e.target.value}),placeholder:"DBMS, AI Lab, etc."})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Subject Type *"}),(0,l.jsxs)("select",{value:B.subjectType,onChange:e=>z({...B,subjectType:e.target.value}),children:[(0,l.jsx)("option",{value:"Core",children:"Core"}),(0,l.jsx)("option",{value:"Elective",children:"Elective"}),(0,l.jsx)("option",{value:"Lab",children:"Lab"}),(0,l.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Hours per Week *"}),(0,l.jsx)("input",{type:"number",min:"1",max:"30",value:B.hoursPerWeek,onChange:e=>z({...B,hoursPerWeek:parseInt(e.target.value)||6})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Teacher *"}),(0,l.jsxs)("select",{value:B.teacher,onChange:e=>z({...B,teacher:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"-- Select Teacher --"}),H.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))]})]})]}),(0,l.jsxs)("div",{className:"checkbox-group",children:[(0,l.jsx)("input",{type:"checkbox",id:"continuous",checked:B.isContinuous,onChange:e=>z({...B,isContinuous:e.target.checked})}),(0,l.jsx)("label",{htmlFor:"continuous",style:{marginBottom:0},children:"Continuous Period (Lab)"})]}),B.isContinuous&&(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Block Size"}),(0,l.jsxs)("select",{value:B.blockSize,onChange:e=>z({...B,blockSize:parseInt(e.target.value)}),children:[(0,l.jsx)("option",{value:2,children:"2 Periods"}),(0,l.jsx)("option",{value:3,children:"3 Periods"})]})]}),(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:el,children:B.id?"ðŸ’¾ Save Changes":"âž• Add Subject"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{ei(),F(!1)},children:"âŒ Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",id:"generate-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"âš¡"}),(0,l.jsx)("h2",{className:"section-title",children:"Generate Timetable"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Ready to Generate"}),(0,l.jsxs)("div",{className:"stats-grid",children:[(0,l.jsxs)("div",{className:"stat-card stat-primary",children:[(0,l.jsx)("div",{className:"stat-label",children:"Classes"}),(0,l.jsx)("div",{className:"stat-value",children:f.length})]}),(0,l.jsxs)("div",{className:"stat-card stat-success",children:[(0,l.jsx)("div",{className:"stat-label",children:"Teachers"}),(0,l.jsx)("div",{className:"stat-value",children:H.length})]}),(0,l.jsxs)("div",{className:"stat-card stat-warning",children:[(0,l.jsx)("div",{className:"stat-label",children:"Subjects"}),(0,l.jsx)("div",{className:"stat-value",children:N.length})]})]}),(0,l.jsx)("button",{className:"btn btn-success btn-lg",onClick:ec,disabled:w,children:w?"â³ Generating...":"âš¡ Generate Timetable"})]})]}),C&&(0,l.jsxs)("div",{className:"section",id:"view-timetables",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“Š"}),(0,l.jsx)("h2",{className:"section-title",children:"Generated Timetables"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Time Tables"}),[...f].sort((e,s)=>e.name.localeCompare(s.name)).map(e=>(0,l.jsxs)("div",{className:"timetable-container",id:`timetable-export-${e.id}`,children:[(0,l.jsx)("h4",{className:"timetable-title",children:e.name}),(0,l.jsx)("div",{className:"timetable-scroll",children:(0,l.jsx)(d.default,{timetable:C.classTimetables,className:e.name})}),(0,l.jsx)("div",{className:"timetable-actions no-print no-export",children:(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>(0,h.exportToPDF)(`timetable-export-${e.id}`,`${e.name}_Timetable.pdf`,{title:e.name}),children:"ðŸ“„ Download PDF"})})]},e.id))]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Staff-wise Timetables"}),[...H].sort((e,s)=>e.name.localeCompare(s.name)).map(e=>(0,l.jsxs)("div",{className:"timetable-container",id:`staff-timetable-export-${e.id}`,children:[(0,l.jsxs)("h4",{className:"timetable-title",children:["Teacher: ",e.name]}),(0,l.jsx)("div",{className:"timetable-scroll",children:(0,l.jsx)(o.default,{timetable:C.staffTimetables,staffName:e.name})}),(0,l.jsx)("div",{className:"timetable-actions no-print no-export",children:(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>(0,h.exportToPDF)(`staff-timetable-export-${e.id}`,`${e.name}_Timetable.pdf`,{title:`Staff Timetable \u{2014} ${e.name}`}),children:"ðŸ“„ Download PDF"})})]},e.id))]})]})]}),(0,l.jsx)(n.ToastContainer,{toasts:S,onRemove:V})]})}}),a("2A5UH",function(a,t){e(a.exports,"ToastContainer",()=>i);var l=s("ayMG0");s("acw62");let r=({id:e,message:s,type:a,onRemove:t,undoAction:r})=>(0,l.jsxs)("div",{style:{padding:"12px 16px",borderRadius:"8px",marginBottom:"10px",background:"error"===a?"#ff4444":"success"===a?"#00C851":"#ffbb33",color:"white",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",animation:"slideIn 0.3s ease-out"},children:[(0,l.jsx)("span",{children:s}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",marginLeft:"16px"},children:[r&&(0,l.jsx)("button",{onClick:()=>{"function"==typeof r&&r(),"function"==typeof t&&t(e)},style:{background:"white",color:"success"===a?"#00C851":"#333",border:"none",padding:"4px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"13px",fontWeight:"600"},children:"UNDO"}),(0,l.jsx)("button",{onClick:()=>{"function"==typeof t&&t(e)},style:{background:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"18px",padding:"0 4px",lineHeight:"1"},title:"Close",children:"Ã—"})]})]}),i=({toasts:e,onRemove:s})=>(0,l.jsx)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,minWidth:"300px",maxWidth:"500px"},children:e.map(e=>(0,l.jsx)(r,{id:e.id,message:e.message,type:e.type,onRemove:s,undoAction:e.undoAction},e.id))})}),a("4XiCD",function(a,t){e(a.exports,"default",()=>r);var l=s("ayMG0");function r({timetable:e,staff:s}){if(!e||!e.staffTimetables)return null;let a=s.filter(e=>"staff"===e.role);return(0,l.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,l.jsx)("h3",{style:{marginBottom:"15px"},children:"ðŸ“Š Staff Hours Summary"}),(0,l.jsxs)("table",{className:"data-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Staff Name"}),(0,l.jsx)("th",{children:"Teaching Hours"}),(0,l.jsx)("th",{children:"Free Periods"}),(0,l.jsx)("th",{children:"Status"})]})}),(0,l.jsx)("tbody",{children:a.map(s=>{let a=e.staffTimetables[s.name];if(!a)return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:s.name}),(0,l.jsx)("td",{children:"0"}),(0,l.jsx)("td",{children:"30"}),(0,l.jsx)("td",{children:"âš ï¸ Not Assigned"})]},s.id);let t=0,r=0;a.forEach(e=>{e.forEach(e=>{e&&"free"!==e.type?t++:r++})});let i=t>=24?"âœ… Full Load":t>=18?"âš¡ Good":t>0?"âš ï¸ Low Load":"âŒ No Classes";return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:s.name}),(0,l.jsxs)("td",{children:[t,"/30"]}),(0,l.jsxs)("td",{children:[r,"/30"]}),(0,l.jsx)("td",{children:i})]},s.id)})})]})]})}s("acw62")}),a("e3nvF",function(a,t){e(a.exports,"default",()=>n);var l=s("ayMG0"),r=s("acw62");let i=["Monday","Tuesday","Wednesday","Thursday","Friday"];function n({timetable:e,className:s}){if(!e||!e[s])return(0,l.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#64748b"},children:"No timetable available"});let a=e[s];return(console.log("TimetableGrid - className:",s),console.log("TimetableGrid - grid:",a),console.log("TimetableGrid - grid is array?",Array.isArray(a)),Array.isArray(a)&&0!==a.length)?(0,l.jsxs)("div",{id:"timetable-export",className:"timetable-grid",children:[(0,l.jsx)("div",{className:"timetable-header",children:"Day/Period"}),[...Array(6)].map((e,s)=>(0,l.jsxs)("div",{className:"timetable-header",children:["P",s+1]},s)),i.map((e,s)=>a[s]&&Array.isArray(a[s])?(0,l.jsxs)((r&&r.__esModule?r.default:r).Fragment,{children:[(0,l.jsx)("div",{className:"timetable-day",children:e}),a[s].map((e,s)=>(0,l.jsx)("div",{className:`timetable-cell subject-${e&&e.type?e.type.toLowerCase():"free"}`,children:e&&"FREE"!==e.subject?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"subject-name",children:e.subject}),(0,l.jsx)("div",{className:"teacher-name",children:e.teacher})]}):(0,l.jsx)("div",{style:{color:"#94a3b8"},children:"FREE"})},s))]},e):null)]}):(0,l.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#64748b"},children:"Invalid timetable format"})}}),a("hyYFF",function(a,t){e(a.exports,"default",()=>r);var l=s("ayMG0");function r({timetable:e,staffName:s}){let a=["P1","P2","P3","P4","P5","P6"],t=e[s];return(console.log("StaffTimetableGrid - Staff:",s),console.log("StaffTimetableGrid - Available:",Object.keys(e)),t)?(0,l.jsx)("div",{className:"timetable-container",id:"staff-timetable-export",children:(0,l.jsxs)("table",{className:"timetable",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"day-header",children:"DAY/PERIOD"}),a.map(e=>(0,l.jsx)("th",{className:"period-header",children:e},e))]})}),(0,l.jsx)("tbody",{children:["Monday","Tuesday","Wednesday","Thursday","Friday"].map((e,s)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"day-cell",children:e}),a.map((e,a)=>{let r=t[s]?.[a],i=!r||"free"===r.type||"FREE"===r.subject;return(0,l.jsx)("td",{className:`period-cell ${i?"free-period":"class-period"}`,children:i?(0,l.jsx)("div",{className:"period-content free",children:(0,l.jsx)("span",{className:"subject-name",children:"FREE"})}):(0,l.jsxs)("div",{className:"period-content",children:[(0,l.jsx)("span",{className:"subject-name",children:r.subject}),(0,l.jsx)("span",{className:"class-name",children:r.class})]})},e)})]},e))})]})}):(0,l.jsxs)("div",{style:{padding:"40px",textAlign:"center"},children:[(0,l.jsx)("div",{style:{fontSize:"48px",marginBottom:"20px"},children:"âš ï¸"}),(0,l.jsx)("h3",{children:"No Timetable Found"}),(0,l.jsxs)("p",{style:{color:"#64748b"},children:['No timetable for "',s,'"']}),(0,l.jsxs)("p",{style:{color:"#64748b",fontSize:"14px"},children:["Available: ",Object.keys(e).join(", ")]})]})}s("acw62")}),a("bU9CP",function(s,a){e(s.exports,"TimetableGenerator",()=>t);class t{constructor(e,s,a){this.classes=e||[],this.staff=s||[],this.subjects=a||[],this.classTimetables={},this.staffTimetables={},this.teacherSlots={},this.DAYS=["Monday","Tuesday","Wednesday","Thursday","Friday"],this.PERIODS=6,this.TOTAL_HOURS=30,this.labPositionsUsed={},this._seed=Date.now()}_random(){return this._seed=(1664525*this._seed+0x3c6ef35f)%0x100000000,this._seed/0x100000000}_shuffle(e){let s=[...e];for(let e=s.length-1;e>0;e--){let a=Math.floor(this._random()*(e+1));[s[e],s[a]]=[s[a],s[e]]}return s}validate(){let e=[];return this.classes?.length||e.push("No classes defined"),this.staff?.filter(e=>e?.role==="staff").length||e.push("No staff defined"),this.subjects?.length||e.push("No subjects defined"),this.classes.forEach(s=>{let a=this.subjects.filter(e=>e?.className===s.name).reduce((e,s)=>e+(s.hoursPerWeek||0),0);a!==this.TOTAL_HOURS&&e.push(`Class "${s.name}": Total hours = ${a}, MUST be ${this.TOTAL_HOURS}!`)}),e.length?{valid:!1,errors:e}:{valid:!0}}generate(){console.log("ðŸš€ TIMETABLE GENERATOR - RANDOM LAB POSITIONS"),console.log("=".repeat(60));let e=this.validate();if(!e.valid)return console.error("âŒ VALIDATION FAILED:"),e.errors.forEach(e=>console.error(`  \u{2022} ${e}`)),{success:!1,error:e.errors.join("; "),classTimetables:{},staffTimetables:{}};this._initialize();let s=!0;for(let e of this.classes)e?.name&&(console.log(`
\u{1F4DA} Generating: ${e.name}`),this.labPositionsUsed[e.name]=[],this._generateForClass(e.name)||(s=!1));return this._buildStaffTimetables(),{success:s,classTimetables:this.classTimetables,staffTimetables:this.staffTimetables}}_initialize(){this.classes.forEach(e=>{e?.name&&(this.classTimetables[e.name]=this.DAYS.map(()=>Array(this.PERIODS).fill(null)))}),this.staff.forEach(e=>{e?.name&&(this.teacherSlots[e.name]={})})}_generateForClass(e){let s=this.subjects.filter(s=>s?.className===e);if(!s.length)return!0;let a=s.filter(e=>e.isContinuous),t=s.filter(e=>!e.isContinuous),l={daysUsed:{},dayPeriodMap:{},periodWeeklyCount:{},periodGlobalUsage:Array(6).fill(0),hoursPlaced:{}};t.forEach(e=>{l.daysUsed[e.name]=new Set,l.dayPeriodMap[e.name]={},l.periodWeeklyCount[e.name]=Array(6).fill(0),l.hoursPlaced[e.name]=0});let r={lastDay:{},dayLabCount:{},hoursPlaced:{}};this.DAYS.forEach(e=>r.dayLabCount[e]=0),a.forEach(e=>r.hoursPlaced[e.name]=0);let i={};for(let s of(this.DAYS.forEach(e=>i[e]=new Set),console.log("\n  ðŸ”¬ Phase 1: Labs..."),a)){let a=Math.floor((s.hoursPerWeek||0)/2);for(let t=0;t<a;t++){if(!this._placeLabBlock(e,s,r,i))return console.error(`  \u{274C} Failed to place lab: ${s.name}`),!1;r.hoursPlaced[s.name]+=2}}console.log("\n  ðŸ“– Phase 2: Theory first-pass...");let n=[...t].sort((e,s)=>(s.hoursPerWeek||0)-(e.hoursPerWeek||0));for(let s of n){let a=s.hoursPerWeek||0,t=Math.min(a,5);for(let r=0;r<5&&l.hoursPlaced[s.name]<t;r++)!l.daysUsed[s.name].has(r)&&this._placeTheory(e,s,l,r,i,"strict")&&(l.hoursPlaced[s.name]++,console.log(`    \u{2713} ${s.name}: ${this.DAYS[r]} (${l.hoursPlaced[s.name]}/${a})`))}for(let s of(console.log("\n  ðŸ“ Phase 3: Remaining (strict)..."),n)){let a=s.hoursPerWeek||0;for(;l.hoursPlaced[s.name]<a;)if(this._placeTheory(e,s,l,null,i,"strict"))l.hoursPlaced[s.name]++;else break}for(let s of(console.log("\n  âš¡ Phase 4: Relaxed..."),n)){let a=s.hoursPerWeek||0;for(;l.hoursPlaced[s.name]<a;)if(this._placeTheory(e,s,l,null,i,"relaxed"))l.hoursPlaced[s.name]++;else break}for(let s of(console.log("\n  ðŸ”¥ Phase 5: Force..."),n)){let a=s.hoursPerWeek||0;for(;l.hoursPlaced[s.name]<a;)if(this._forcePlaceTheory(e,s,l,i))l.hoursPlaced[s.name]++;else{console.warn(`  \u{26A0}\u{FE0F} Cannot place ${s.name}: ${l.hoursPlaced[s.name]}/${a}`);break}}let c=this._countPlacedHours(e);return console.log(`
  \u{2713} Total: ${c}/${this.TOTAL_HOURS} hours`),this._checkDayVariety(i),!0}_countPlacedHours(e){let s=this.classTimetables[e],a=0;for(let e=0;e<5;e++)for(let t=0;t<this.PERIODS;t++)s[e][t]&&a++;return a}_checkDayVariety(e){this.DAYS.forEach(s=>{let a=e[s].size;a<3&&console.warn(`    \u{26A0}\u{FE0F} ${s}: Only ${a} different subjects`)})}_placeLabBlock(e,s,a,t){let l=s.teacher,r=this.classTimetables[e],i=[],n=this._shuffle([0,1,2,3,4]);for(let t=0;t<5;t++){let c=this.DAYS[t],d=100;if(void 0!==a.lastDay[s.name]){let e=Math.abs(t-a.lastDay[s.name]);e>=2?d+=50:1===e&&(d-=20)}for(let s of n){if(s>this.PERIODS-2||r[t][s]||r[t][s+1])continue;let n=`${c}-P${s+1}`,o=`${c}-P${s+2}`;if(this.teacherSlots[l]?.[n]||this.teacherSlots[l]?.[o])continue;let h=d;0===a.dayLabCount[c]?h+=40:1===a.dayLabCount[c]&&(h-=20);let m=(this.labPositionsUsed[e]||[]).filter(e=>e===s).length;0===m?h+=30:h-=15*m,s>=1&&s<=3&&(h+=10),i.push({dayIdx:t,startP:s,score:h,day:c})}}if(0===i.length)return console.error(`      \u{274C} No slots for ${s.name}`),!1;i.sort((e,s)=>s.score-e.score);let c=i[0];r[c.dayIdx][c.startP]={subject:s.name,teacher:l,type:s.subjectType||"lab",isLab:!0},r[c.dayIdx][c.startP+1]={subject:s.name,teacher:l,type:s.subjectType||"lab",isLab:!0,isLabContinuation:!0};let d=`${c.day}-P${c.startP+1}`,o=`${c.day}-P${c.startP+2}`;return this.teacherSlots[l]||(this.teacherSlots[l]={}),this.teacherSlots[l][d]=e,this.teacherSlots[l][o]=e,this.labPositionsUsed[e].push(c.startP),a.lastDay[s.name]=c.dayIdx,a.dayLabCount[c.day]++,t[c.day].add(s.name),console.log(`      \u{2713} ${s.name}: ${c.day} P${c.startP+1}-P${c.startP+2}`),!0}_placeTheory(e,s,a,t,l,r){let i=s.teacher,n=this.classTimetables[e],c=[];for(let e of null!==t?[t]:[0,1,2,3,4]){let t=this.DAYS[e];for(let d=0;d<this.PERIODS;d++){if(n[e][d])continue;let o=`${t}-P${d+1}`;if(this.teacherSlots[i]?.[o]||e>0&&a.dayPeriodMap[s.name]?.[e-1]===d||this._wouldExceedContinuous(n,e,d,s.name,2)||"strict"===r&&a.periodWeeklyCount[s.name][d]>=2)continue;let h=100;a.daysUsed[s.name].has(e)||(h+=40);let m=a.periodWeeklyCount[s.name][d];if(0===m?h+=30:h-=25*m,h-=5*a.periodGlobalUsage[d],l[t].has(s.name)||(h+=20),e>0){let t=a.dayPeriodMap[s.name]?.[e-1];void 0!==t&&t!==d&&(h+=15)}d>=1&&d<=4&&(h+=10),c.push({dayIdx:e,period:d,score:h,day:t})}}if(0===c.length)return!1;c.sort((e,s)=>s.score-e.score);let d=c[0],o=`${d.day}-P${d.period+1}`;return n[d.dayIdx][d.period]={subject:s.name,teacher:i,type:s.subjectType||"core"},this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i][o]=e,a.daysUsed[s.name].add(d.dayIdx),a.dayPeriodMap[s.name][d.dayIdx]=d.period,a.periodWeeklyCount[s.name][d.period]++,a.periodGlobalUsage[d.period]++,l[d.day].add(s.name),!0}_wouldExceedContinuous(e,s,a,t,l){let r=1;for(let l=a-1;l>=0;l--)if(e[s][l]?.subject===t)r++;else break;for(let l=a+1;l<this.PERIODS;l++)if(e[s][l]?.subject===t)r++;else break;return r>l}_forcePlaceTheory(e,s,a,t){let l=s.teacher,r=this.classTimetables[e];for(let a=0;a<5;a++){let i=this.DAYS[a];for(let n=0;n<this.PERIODS;n++){if(r[a][n])continue;let c=`${i}-P${n+1}`;if(!this.teacherSlots[l]?.[c]&&!this._wouldExceedContinuous(r,a,n,s.name,2))return r[a][n]={subject:s.name,teacher:l,type:s.subjectType||"core",isForced:!0},this.teacherSlots[l]||(this.teacherSlots[l]={}),this.teacherSlots[l][c]=e,t[i].add(s.name),!0}}return!1}_buildStaffTimetables(){this.staff.forEach(e=>{e?.name&&(this.staffTimetables[e.name]=this.DAYS.map(()=>Array(this.PERIODS).fill(null).map(()=>({subject:"FREE",class:"-",type:"free"}))))}),Object.keys(this.classTimetables).forEach(e=>{let s=this.classTimetables[e];this.DAYS.forEach((a,t)=>{s[t].forEach((s,a)=>{s?.teacher&&"-"!==s.teacher&&this.staffTimetables[s.teacher]&&(this.staffTimetables[s.teacher][t][a]={subject:s.subject,class:e,type:s.type})})})})}}});
//# sourceMappingURL=AdminDashboard.92aa9809.js.map

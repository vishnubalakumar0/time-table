function e(e,s,a,t){Object.defineProperty(e,s,{get:a,set:t,enumerable:!0,configurable:!0})}var s=globalThis.parcelRequireb79f,a=s.register;a("dXtBz",function(a,t){Object.defineProperty(a.exports,"__esModule",{value:!0,configurable:!0}),e(a.exports,"default",()=>x);var l=s("ayMG0"),i=s("acw62"),r=s("aOD4d"),n=s("2A5UH"),c=s("4XiCD"),d=s("e3nvF"),o=s("hyYFF"),h=s("gqAsg"),m=s("bU9CP"),u=s("fAZ67"),b=s("6AR8M"),j=s("ilpIi");function x({user:e,onLogout:s}){let[a,t]=(0,i.useState)([]),[x,p]=(0,i.useState)([]),[f,g]=(0,i.useState)([]),[y,N]=(0,i.useState)(null),[v,C]=(0,i.useState)([]),[S,w]=(0,i.useState)(!0),[k,T]=(0,i.useState)(!1),[P,E]=(0,i.useState)(!1),[D,A]=(0,i.useState)(!1),F=(0,i.useRef)(null),R=(0,i.useRef)(null),$=(0,i.useRef)(null),W=(0,i.useRef)([]),[I,M]=(0,i.useState)({name:"",hallNumber:""}),[B,O]=(0,i.useState)({id:null,name:"",username:"",password:"",freePeriodMode:"auto",manualFreePeriods:0}),[_,H]=(0,i.useState)({id:null,className:"",name:"",subjectType:"Core",hoursPerWeek:6,isContinuous:!1,blockSize:2,teacher:""}),z=x.filter(e=>"staff"===e.role),L=(e,s,a=null,t=3e3)=>{let l={message:e,type:s,id:Date.now(),undoAction:a||null};C(e=>[...e,l]),setTimeout(()=>U(l.id),t)},U=e=>{C(s=>s.filter(s=>s.id!==e))},G=e=>{if(!e)return null;let s={};return Object.keys(e).forEach(a=>{let t=e[a];if(Array.isArray(t)&&t.length>0&&Array.isArray(t[0]))s[a]=t;else if(Array.isArray(t)){let e=[[],[],[],[],[]];t.forEach(s=>{s&&"number"==typeof s.day&&"number"==typeof s.period&&(e[s.day]||(e[s.day]=[]),e[s.day][s.period]={subject:s.subject,teacher:s.teacher,class:s.class,type:s.type})}),e.forEach((s,a)=>{e[a]||(e[a]=[]);for(let s=0;s<6;s++)e[a][s]||(e[a][s]=t[0]?.class!==void 0?{subject:"FREE",class:"-",type:"free"}:null)}),s[a]=e}}),s};(0,i.useEffect)(()=>{(async()=>{try{let[e,s,a,l]=await Promise.all([(0,j.getDocs)((0,j.collection)(u.db,"classes")),(0,j.getDocs)((0,j.collection)(u.db,"staff")),(0,j.getDocs)((0,j.collection)(u.db,"subjects")),(0,j.getDocs)((0,j.collection)(u.db,"timetable"))]);if(t(e.docs.map(e=>({id:e.id,...e.data()}))),p(s.docs.map(e=>({id:e.id,...e.data()}))),g(a.docs.map(e=>({id:e.id,...e.data()}))),!l.empty){let e=l.docs[0].data(),s={classTimetables:G(e.classTimetables),staffTimetables:G(e.staffTimetables)};N(s)}}catch(e){L("âŒ Error: "+e.message,"error")}finally{w(!1)}})()},[]);let Y=async()=>{if(!I.name)return L("Enter class name","error");if(a.find(e=>e.name===I.name&&!I.id))return L("Class already exists","error");try{if(I.id)await (0,j.updateDoc)((0,j.doc)(u.db,"classes",I.id),{name:I.name,hallNumber:I.hallNumber}),t(a.map(e=>e.id===I.id?{...I}:e)),L("âœ… Class updated!","success");else{let e=await (0,j.addDoc)((0,j.collection)(u.db,"classes"),{name:I.name,hallNumber:I.hallNumber||""});t([...a,{id:e.id,name:I.name,hallNumber:I.hallNumber||""}]),L("âœ… Class added!","success")}M({name:"",hallNumber:""}),T(!1)}catch(e){L("âŒ Operation failed","error")}},V=e=>{M({id:e.id,name:e.name,hallNumber:e.hallNumber||""}),T(!0),setTimeout(()=>{$.current?.scrollIntoView({behavior:"smooth",block:"center"})},100)},q=async e=>{if(!window.confirm("Delete this class?"))return;let s=a.find(s=>s.id===e);if(s)try{await (0,j.deleteDoc)((0,j.doc)(u.db,"classes",e)),t(a.filter(s=>s.id!==e));let l={type:"class",data:s,timestamp:Date.now()};W.current.push(l);let i=async()=>{try{await (0,j.setDoc)((0,j.doc)(u.db,"classes",s.id),{name:s.name,hallNumber:s.hallNumber||""}),t(e=>[...e,s]),W.current=W.current.filter(e=>e.timestamp!==l.timestamp),L("âœ… Class restored","success")}catch(e){L("âŒ Failed to restore","error")}};L("Class deleted â€” Undo?","success",i,5e3)}catch(e){L("âŒ Failed to delete","error")}},X=async()=>{if(!B.name||!B.username)return L("Fill all required fields","error");try{if(B.id){let{password:e,...s}=B;return await (0,j.updateDoc)((0,j.doc)(u.db,"staff",B.id),s),p(x.map(e=>e.id===B.id?{...e,...s}:e)),K(),E(!1),L("âœ… Staff updated!","success")}if(!B.password)return L("Password required","error");let e=`${B.username}@timetable.com`,s=(await (0,b.createUserWithEmailAndPassword)(u.auth,e,B.password)).user.uid,a={name:B.name,username:B.username,freePeriodMode:B.freePeriodMode,manualFreePeriods:B.manualFreePeriods,role:"staff",firebaseUid:s},t=await (0,j.addDoc)((0,j.collection)(u.db,"staff"),a);await (0,j.setDoc)((0,j.doc)(u.db,"users",s),{name:B.name,username:B.username,role:"staff"}),p([...x,{id:t.id,...a}]),K(),E(!1),L("âœ… Staff added!","success")}catch(e){L("âŒ Operation failed: "+e.message,"error")}},J=e=>{O({...e,password:""}),E(!0),setTimeout(()=>{F.current?.scrollIntoView({behavior:"smooth",block:"center"})},100)},K=()=>{O({id:null,name:"",username:"",password:"",freePeriodMode:"auto",manualFreePeriods:0})},Z=async e=>{if(!window.confirm("Delete this staff member?"))return;let s=x.find(s=>s.id===e);if(s)try{await (0,j.deleteDoc)((0,j.doc)(u.db,"staff",e)),p(x.filter(s=>s.id!==e));let a={type:"staff",data:s,timestamp:Date.now()};W.current.push(a);let t=async()=>{try{await (0,j.setDoc)((0,j.doc)(u.db,"staff",s.id),{name:s.name,username:s.username,freePeriodMode:s.freePeriodMode,manualFreePeriods:s.manualFreePeriods||0,role:s.role||"staff",firebaseUid:s.firebaseUid||null}),p(e=>[...e,s]),W.current=W.current.filter(e=>e.timestamp!==a.timestamp),L("âœ… Staff restored","success")}catch(e){L("âŒ Failed to restore","error")}};L("Staff deleted â€” Undo?","success",t,5e3)}catch(e){L("âŒ Failed to delete","error")}},Q=async()=>{if(!_.className||!_.name||!_.teacher)return L("Fill all required fields","error");try{let e={className:_.className,name:_.name,subjectType:_.subjectType,hoursPerWeek:_.hoursPerWeek,isContinuous:_.isContinuous,blockSize:_.blockSize,teacher:_.teacher};if(_.id)await (0,j.updateDoc)((0,j.doc)(u.db,"subjects",_.id),e),g(f.map(s=>s.id===_.id?{id:_.id,...e}:s)),L("âœ… Subject updated!","success");else{let s=await (0,j.addDoc)((0,j.collection)(u.db,"subjects"),e);g([...f,{id:s.id,...e}]),L("âœ… Subject added!","success")}es(),A(!1)}catch(e){L("âŒ Operation failed","error"),console.error(e)}},ee=e=>{H({id:e.id,className:e.className,name:e.name,subjectType:e.subjectType,hoursPerWeek:e.hoursPerWeek,isContinuous:e.isContinuous||!1,blockSize:e.blockSize||2,teacher:e.teacher}),A(!0),setTimeout(()=>{R.current?.scrollIntoView({behavior:"smooth",block:"center"})},100)},es=()=>{H({id:null,className:"",name:"",subjectType:"Core",hoursPerWeek:6,isContinuous:!1,blockSize:2,teacher:""})},ea=async e=>{if(!window.confirm("Delete this subject?"))return;let s=f.find(s=>s.id===e);if(s)try{await (0,j.deleteDoc)((0,j.doc)(u.db,"subjects",e)),g(f.filter(s=>s.id!==e));let a={type:"subject",data:s,timestamp:Date.now()};W.current.push(a);let t=async()=>{try{await (0,j.setDoc)((0,j.doc)(u.db,"subjects",s.id),{className:s.className,name:s.name,subjectType:s.subjectType,hoursPerWeek:s.hoursPerWeek,isContinuous:s.isContinuous||!1,blockSize:s.blockSize||2,teacher:s.teacher}),g(e=>[...e,s]),W.current=W.current.filter(e=>e.timestamp!==a.timestamp),L("âœ… Subject restored","success")}catch(e){L("âŒ Failed to restore","error")}};L("Subject deleted â€” Undo?","success",t,5e3)}catch(e){L("âŒ Failed to delete","error")}},et=async()=>{w(!0);try{let e=new(0,m.TimetableGenerator)(a,x.filter(e=>"staff"===e.role),f),s=e.validate();if(!s.valid){L("âŒ Validation: "+s.errors[0],"error"),w(!1);return}let t=e.generate();if(t.success){let e={},s={};Object.keys(t.classTimetables).forEach(s=>{e[s]=t.classTimetables[s].map((e,s)=>e.map((e,a)=>({day:s,period:a,subject:e?.subject||null,teacher:e?.teacher||null,type:e?.type||null}))).flat()}),Object.keys(t.staffTimetables).forEach(e=>{s[e]=t.staffTimetables[e].map((e,s)=>e.map((e,a)=>({day:s,period:a,subject:e?.subject||null,class:e?.class||null,type:e?.type||null}))).flat()});let a={classTimetables:e,staffTimetables:s,generatedAt:new Date().toISOString()},l=(0,j.collection)(u.db,"timetable"),i=await (0,j.getDocs)(l);for(let e of(i.empty?await (0,j.addDoc)(l,a):await (0,j.updateDoc)((0,j.doc)(u.db,"timetable",i.docs[0].id),a),x.filter(e=>"staff"===e.role))){let a=s[e.name];a&&await (0,j.setDoc)((0,j.doc)(u.db,"staffTimetables",e.id),{staffName:e.name,timetable:a,generatedAt:new Date().toISOString()})}let r={};Object.keys(e).forEach(s=>{let a=[[],[],[],[],[]];e[s].forEach(e=>{a[e.day]||(a[e.day]=[]),a[e.day][e.period]={subject:e.subject,teacher:e.teacher,type:e.type}}),a.forEach((e,s)=>{a[s]||(a[s]=[]);for(let e=0;e<6;e++)a[s][e]||(a[s][e]=null)}),r[s]=a});let n={};Object.keys(s).forEach(e=>{let a=[[],[],[],[],[]];s[e].forEach(e=>{a[e.day]||(a[e.day]=[]),a[e.day][e.period]={subject:e.subject,class:e.class,type:e.type}}),a.forEach((e,s)=>{a[s]||(a[s]=[]);for(let e=0;e<6;e++)a[s][e]||(a[s][e]={subject:"FREE",class:"-",type:"free"})}),n[e]=a}),N({classTimetables:r,staffTimetables:n}),L("âœ… Timetable generated & saved!","success"),setTimeout(()=>{document.getElementById("view-timetables")?.scrollIntoView({behavior:"smooth"})},1e3)}else L("âŒ Failed: "+t.error,"error")}catch(e){L("âŒ Error: "+e.message,"error"),console.error(e)}w(!1)};return S?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.default,{}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",color:"white",fontSize:"24px",gap:"20px"},children:[(0,l.jsx)("div",{className:"spinner"}),(0,l.jsx)("div",{children:"Loading..."})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.default,{}),(0,l.jsx)("div",{className:"header",children:(0,l.jsxs)("div",{className:"header-content",children:[(0,l.jsx)("h1",{children:"ðŸ« Admin Dashboard"}),(0,l.jsx)("div",{className:"header-actions",children:(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:s,children:"Logout"})})]})}),(0,l.jsxs)("div",{className:"content",children:[(0,l.jsxs)("div",{className:"section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“š"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Classes"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,l.jsxs)("h3",{children:["Existing Classes (",a.length,")"]}),(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>{T(!k),!k&&I.id&&M({name:"",hallNumber:""})},children:k?"âŒ Cancel":"âž• Add New Class"})]}),0===a.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:'No classes added yet. Click "Add New Class" to start.'}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"#"}),(0,l.jsx)("th",{children:"Class Name"}),(0,l.jsx)("th",{children:"Hall Number"}),(0,l.jsx)("th",{children:"Subjects"}),(0,l.jsx)("th",{children:"Hours"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:a.map((e,s)=>{let a=f.filter(s=>s.className===e.name),t=a.reduce((e,s)=>e+s.hoursPerWeek,0);return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:s+1}),(0,l.jsx)("td",{children:(0,l.jsx)("strong",{children:e.name})}),(0,l.jsx)("td",{children:e.hallNumber||"-"}),(0,l.jsx)("td",{children:a.length}),(0,l.jsx)("td",{children:(0,l.jsxs)("span",{className:`badge ${30===t?"badge-success":"badge-danger"}`,children:[t,"/30h"]})}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>V(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>q(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]},e.id)})})]})}),(0,l.jsx)("div",{className:"mobile-cards",children:a.map((e,s)=>{let a=f.filter(s=>s.className===e.name),t=a.reduce((e,s)=>e+s.hoursPerWeek,0);return(0,l.jsxs)("div",{className:"mobile-card",children:[(0,l.jsxs)("div",{className:"mobile-card-header",children:[(0,l.jsx)("span",{className:"mobile-card-title",children:e.name}),(0,l.jsxs)("span",{className:"mobile-card-badge",children:["#",s+1]})]}),(0,l.jsxs)("div",{className:"mobile-card-body",children:[(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Hall:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:e.hallNumber||"-"})]}),(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Subjects:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:a.length})]}),(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Hours:"}),(0,l.jsxs)("span",{className:"mobile-card-value",children:[t,"/30h"]})]})]}),(0,l.jsxs)("div",{className:"mobile-card-actions",children:[(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>V(e),children:"âœï¸ Edit"}),(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>q(e.id),children:"ðŸ—‘ï¸ Delete"})]})]},e.id)})})]})]}),k&&(0,l.jsxs)("div",{className:"card",ref:$,style:{animation:"slideIn 0.3s ease-out",border:"2px solid #3b82f6"},children:[(0,l.jsx)("h3",{children:I.id?"âœï¸ Edit Class":"âž• Add New Class"}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Class Name *"}),(0,l.jsx)("input",{type:"text",value:I.name,onChange:e=>M({...I,name:e.target.value.toUpperCase()}),placeholder:"CS3A, EE2B"})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Hall Number (Optional)"}),(0,l.jsx)("input",{type:"text",value:I.hallNumber,onChange:e=>M({...I,hallNumber:e.target.value}),placeholder:"Hall 101"})]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:Y,children:I.id?"ðŸ’¾ Update Class":"âž• Add Class"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{M({name:"",hallNumber:""}),T(!1)},children:"âŒ Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ‘¥"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Staff"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,l.jsxs)("h3",{children:["Existing Staff (",z.length,")"]}),(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>{E(!P),!P&&B.id&&K()},children:P?"âŒ Cancel":"âž• Add Staff"})]}),0===z.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:'No staff added yet. Click "Add Staff" to start.'}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"S.No"}),(0,l.jsx)("th",{children:"Name"}),(0,l.jsx)("th",{children:"Username"}),(0,l.jsx)("th",{children:"Mode"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:z.map((e,s)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:(0,l.jsxs)("span",{className:"staff-badge",children:["S",s+1]})}),(0,l.jsx)("td",{children:(0,l.jsx)("strong",{children:e.name})}),(0,l.jsx)("td",{children:e.username}),(0,l.jsx)("td",{children:"manual"===e.freePeriodMode?`Manual (${e.manualFreePeriods})`:"Auto"}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>J(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>Z(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]},e.id))})]})}),(0,l.jsx)("div",{className:"mobile-cards",children:z.map((e,s)=>(0,l.jsxs)("div",{className:"mobile-card",children:[(0,l.jsxs)("div",{className:"mobile-card-header",children:[(0,l.jsx)("span",{className:"mobile-card-title",children:e.name}),(0,l.jsxs)("span",{className:"mobile-card-badge",children:["S",s+1]})]}),(0,l.jsxs)("div",{className:"mobile-card-body",children:[(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Username:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:e.username})]}),(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Mode:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:"manual"===e.freePeriodMode?`Manual (${e.manualFreePeriods})`:"Auto"})]})]}),(0,l.jsxs)("div",{className:"mobile-card-actions",children:[(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>J(e),children:"âœï¸ Edit"}),(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>Z(e.id),children:"ðŸ—‘ï¸ Delete"})]})]},e.id))})]})]}),P&&(0,l.jsxs)("div",{className:"card",ref:F,style:{animation:"slideIn 0.3s ease-out",border:"2px solid #3b82f6"},children:[(0,l.jsx)("h3",{children:B.id?"âœï¸ Edit Staff":"âž• Add New Staff"}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Full Name *"}),(0,l.jsx)("input",{type:"text",placeholder:"Dr. John Doe",value:B.name,onChange:e=>O({...B,name:e.target.value})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Username *"}),(0,l.jsx)("input",{type:"text",placeholder:"john",disabled:!!B.id,value:B.username,onChange:e=>O({...B,username:e.target.value}),style:B.id?{background:"#f1f5f9",cursor:"not-allowed"}:{}})]}),!B.id&&(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Password *"}),(0,l.jsx)("input",{type:"password",placeholder:"Password",value:B.password,onChange:e=>O({...B,password:e.target.value})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Free Period Mode"}),(0,l.jsxs)("select",{value:B.freePeriodMode,onChange:e=>O({...B,freePeriodMode:e.target.value}),children:[(0,l.jsx)("option",{value:"auto",children:"Auto"}),(0,l.jsx)("option",{value:"manual",children:"Manual"})]})]})]}),"manual"===B.freePeriodMode&&(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Free Periods per Week"}),(0,l.jsx)("input",{type:"number",min:"0",max:"30",value:B.manualFreePeriods,onChange:e=>O({...B,manualFreePeriods:parseInt(e.target.value)||0})})]}),(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:X,children:B.id?"ðŸ’¾ Save Changes":"âž• Add Staff"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{K(),E(!1)},children:"âŒ Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",id:"subject-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“–"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Subjects"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,l.jsxs)("h3",{children:["Existing Subjects (",f.length,")"]}),(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>{A(!D),!D&&_.id&&es()},children:D?"âŒ Cancel":"âž• Add Subject"})]}),0===f.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:'No subjects added yet. Click "Add Subject" to start.'}):(0,l.jsx)(l.Fragment,{children:a.map(e=>{let s=f.filter(s=>s.className===e.name);if(0===s.length)return null;let a=s.reduce((e,s)=>e+s.hoursPerWeek,0),t=30-a,i=a/30*100;return(0,l.jsxs)("div",{style:{marginBottom:"30px",padding:"20px",background:"#f8fafc",borderRadius:"12px",border:"1px solid #e2e8f0"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px",flexWrap:"wrap",gap:"10px"},children:[(0,l.jsxs)("h4",{style:{margin:0,color:"#1e293b",fontSize:"18px",fontWeight:"600"},children:["ðŸ“š Class: ",e.name]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,l.jsxs)("span",{className:`badge ${30===a?"badge-success":a>30?"badge-danger":"badge-warning"}`,children:[a,"/30 hours"]}),t>0&&(0,l.jsxs)("span",{className:"badge badge-info",children:[t,"h remaining"]}),a>30&&(0,l.jsxs)("span",{className:"badge badge-danger",children:["âš ï¸ ",a-30,"h overflow!"]})]})]}),(0,l.jsx)("div",{style:{width:"100%",height:"12px",background:"#e2e8f0",borderRadius:"6px",overflow:"hidden",marginBottom:"15px"},children:(0,l.jsx)("div",{style:{width:`${Math.min(i,100)}%`,height:"100%",background:30===a?"#10b981":a>30?"#ef4444":"#f59e0b",transition:"width 0.3s ease"}})}),(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Subject"}),(0,l.jsx)("th",{children:"Type"}),(0,l.jsx)("th",{children:"Hours/Week"}),(0,l.jsx)("th",{children:"Teacher"}),(0,l.jsx)("th",{children:"Continuous"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:s.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:(0,l.jsx)("strong",{children:e.name})}),(0,l.jsx)("td",{children:(0,l.jsx)("span",{className:`badge badge-${"Lab"===e.subjectType?"info":"Core"===e.subjectType?"primary":"secondary"}`,children:e.subjectType})}),(0,l.jsx)("td",{children:(0,l.jsxs)("span",{style:{fontWeight:"600",color:"#3b82f6"},children:[e.hoursPerWeek,"h"]})}),(0,l.jsx)("td",{children:e.teacher}),(0,l.jsx)("td",{children:e.isContinuous?(0,l.jsxs)("span",{className:"badge badge-success",children:["âœ“ ",e.blockSize,"p blocks"]}):(0,l.jsx)("span",{style:{color:"#64748b"},children:"No"})}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>ee(e),title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>ea(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]},e.id))})]})}),(0,l.jsx)("div",{className:"mobile-cards",children:s.map(e=>(0,l.jsxs)("div",{className:"mobile-card",children:[(0,l.jsxs)("div",{className:"mobile-card-header",children:[(0,l.jsx)("span",{className:"mobile-card-title",children:e.name}),(0,l.jsx)("span",{className:"mobile-card-badge",children:e.subjectType})]}),(0,l.jsxs)("div",{className:"mobile-card-body",children:[(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Hours:"}),(0,l.jsxs)("span",{className:"mobile-card-value",children:[e.hoursPerWeek,"h"]})]}),(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Teacher:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:e.teacher})]}),(0,l.jsxs)("div",{className:"mobile-card-row",children:[(0,l.jsx)("span",{className:"mobile-card-label",children:"Continuous:"}),(0,l.jsx)("span",{className:"mobile-card-value",children:e.isContinuous?`Yes (${e.blockSize}p)`:"No"})]})]}),(0,l.jsxs)("div",{className:"mobile-card-actions",children:[(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>ee(e),children:"âœï¸ Edit"}),(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>ea(e.id),children:"ðŸ—‘ï¸ Delete"})]})]},e.id))})]},e.id)})})]}),D&&(0,l.jsxs)("div",{className:"card",ref:R,style:{animation:"slideIn 0.3s ease-out",border:"2px solid #3b82f6"},children:[(0,l.jsx)("h3",{children:_.id?"âœï¸ Edit Subject":"âž• Add New Subject"}),_.className&&(0,l.jsx)(c.default,{className:_.className,subjects:f}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Select Class *"}),(0,l.jsxs)("select",{value:_.className,onChange:e=>H({..._,className:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"-- Select Class --"}),a.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Subject Name *"}),(0,l.jsx)("input",{type:"text",value:_.name,onChange:e=>H({..._,name:e.target.value}),placeholder:"DBMS, AI Lab, etc."})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Subject Type *"}),(0,l.jsxs)("select",{value:_.subjectType,onChange:e=>H({..._,subjectType:e.target.value}),children:[(0,l.jsx)("option",{value:"Core",children:"Core"}),(0,l.jsx)("option",{value:"Elective",children:"Elective"}),(0,l.jsx)("option",{value:"Lab",children:"Lab"}),(0,l.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Hours per Week *"}),(0,l.jsx)("input",{type:"number",min:"1",max:"30",value:_.hoursPerWeek,onChange:e=>H({..._,hoursPerWeek:parseInt(e.target.value)||6})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Teacher *"}),(0,l.jsxs)("select",{value:_.teacher,onChange:e=>H({..._,teacher:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"-- Select Teacher --"}),z.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))]})]})]}),(0,l.jsxs)("div",{className:"checkbox-group",children:[(0,l.jsx)("input",{type:"checkbox",id:"continuous",checked:_.isContinuous,onChange:e=>H({..._,isContinuous:e.target.checked})}),(0,l.jsx)("label",{htmlFor:"continuous",style:{marginBottom:0},children:"Continuous Period (Lab)"})]}),_.isContinuous&&(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Block Size"}),(0,l.jsxs)("select",{value:_.blockSize,onChange:e=>H({..._,blockSize:parseInt(e.target.value)}),children:[(0,l.jsx)("option",{value:2,children:"2 Periods"}),(0,l.jsx)("option",{value:3,children:"3 Periods"})]})]}),(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:Q,children:_.id?"ðŸ’¾ Save Changes":"âž• Add Subject"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{es(),A(!1)},children:"âŒ Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"âš¡"}),(0,l.jsx)("h2",{className:"section-title",children:"Generate Timetable"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Ready to Generate"}),(0,l.jsxs)("div",{className:"info-box",children:[(0,l.jsx)("p",{style:{marginBottom:"15px",fontSize:"15px",lineHeight:"1.6"},children:"The smart algorithm will create an optimized timetable:"}),(0,l.jsxs)("ul",{style:{marginLeft:"25px",lineHeight:"1.8"},children:[(0,l.jsx)("li",{children:"âœ… No free periods (all 30 filled)"}),(0,l.jsx)("li",{children:"âœ… High-hour subjects (â‰¥5h) appear daily"}),(0,l.jsx)("li",{children:"âœ… Labs in continuous blocks"}),(0,l.jsx)("li",{children:"âœ… No teacher conflicts"}),(0,l.jsx)("li",{children:"âœ… Balanced workload"})]})]}),(0,l.jsxs)("div",{className:"stats-grid",children:[(0,l.jsxs)("div",{className:"stat-card stat-primary",children:[(0,l.jsx)("div",{className:"stat-label",children:"Classes"}),(0,l.jsx)("div",{className:"stat-value",children:a.length})]}),(0,l.jsxs)("div",{className:"stat-card stat-success",children:[(0,l.jsx)("div",{className:"stat-label",children:"Teachers"}),(0,l.jsx)("div",{className:"stat-value",children:z.length})]}),(0,l.jsxs)("div",{className:"stat-card stat-warning",children:[(0,l.jsx)("div",{className:"stat-label",children:"Subjects"}),(0,l.jsx)("div",{className:"stat-value",children:f.length})]})]}),(0,l.jsx)("button",{className:"btn btn-success btn-lg",onClick:et,disabled:S,children:S?"â³ Generating...":"âš¡ Generate Timetable"})]})]}),y&&(0,l.jsxs)("div",{className:"section",id:"view-timetables",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“Š"}),(0,l.jsx)("h2",{className:"section-title",children:"Generated Timetables"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Class-wise Timetables"}),a.map(e=>(0,l.jsxs)("div",{className:"timetable-container",style:{marginBottom:"40px"},children:[(0,l.jsxs)("h4",{className:"timetable-title",children:["Class: ",e.name," ",e.hallNumber&&`(${e.hallNumber})`]}),(0,l.jsx)("div",{id:`timetable-${e.name}`,className:"timetable-export-wrapper",style:{width:"100%",overflow:"visible",background:"white",padding:"20px",marginBottom:"15px"},children:(0,l.jsx)(d.default,{timetable:y.classTimetables,className:e.name})}),(0,l.jsx)("div",{className:"timetable-actions no-print",children:(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>{let s=document.getElementById(`timetable-${e.name}`);s&&(0,h.exportToPDF)(`timetable-${e.name}`,`${e.name}_Timetable.pdf`,{filename:`${e.name}_Timetable.pdf`,html2canvas:{scale:2,useCORS:!0,logging:!1,width:s.scrollWidth,height:s.scrollHeight},jsPDF:{unit:"mm",format:"a4",orientation:"landscape"}})},children:"ðŸ“„ Download PDF"})})]},e.id))]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Staff-wise Timetables"}),z.map(e=>(0,l.jsxs)("div",{className:"timetable-container",style:{marginBottom:"40px"},children:[(0,l.jsxs)("h4",{className:"timetable-title",children:["Teacher: ",e.name]}),(0,l.jsx)("div",{id:`staff-timetable-${e.name.replace(/\s+/g,"-")}`,className:"timetable-export-wrapper",style:{width:"100%",overflow:"visible",background:"white",padding:"20px",marginBottom:"15px"},children:(0,l.jsx)(o.default,{timetable:y.staffTimetables,staffName:e.name})}),(0,l.jsx)("div",{className:"timetable-actions no-print",children:(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>{let s=e.name.replace(/\s+/g,"-"),a=document.getElementById(`staff-timetable-${s}`);a&&(0,h.exportToPDF)(`staff-timetable-${s}`,`${e.name}_Timetable.pdf`,{filename:`${e.name}_Timetable.pdf`,html2canvas:{scale:2,useCORS:!0,logging:!1,width:a.scrollWidth,height:a.scrollHeight},jsPDF:{unit:"mm",format:"a4",orientation:"landscape"}})},children:"ðŸ“„ Download PDF"})})]},e.id))]})]})]}),(0,l.jsx)(n.ToastContainer,{toasts:v,onRemove:U})]})}}),a("2A5UH",function(a,t){e(a.exports,"ToastContainer",()=>r);var l=s("ayMG0");s("acw62");let i=({id:e,message:s,type:a,onRemove:t,undoAction:i})=>(0,l.jsxs)("div",{style:{padding:"12px 16px",borderRadius:"8px",marginBottom:"10px",background:"error"===a?"#ff4444":"success"===a?"#00C851":"#ffbb33",color:"white",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",animation:"slideIn 0.3s ease-out"},children:[(0,l.jsx)("span",{children:s}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",marginLeft:"16px"},children:[i&&(0,l.jsx)("button",{onClick:()=>{"function"==typeof i&&i(),"function"==typeof t&&t(e)},style:{background:"white",color:"success"===a?"#00C851":"#333",border:"none",padding:"4px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"13px",fontWeight:"600"},children:"UNDO"}),(0,l.jsx)("button",{onClick:()=>{"function"==typeof t&&t(e)},style:{background:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"18px",padding:"0 4px"},children:"Ã—"})]})]}),r=({toasts:e,onRemove:s})=>(0,l.jsx)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,minWidth:"300px",maxWidth:"500px"},children:e.map(e=>(0,l.jsx)(i,{id:e.id,message:e.message,type:e.type,onRemove:s,undoAction:e.undoAction},e.id))})}),a("4XiCD",function(a,t){e(a.exports,"default",()=>i);var l=s("ayMG0");function i({timetable:e,staff:s}){if(!e||!e.staffTimetables)return null;let a=s.filter(e=>"staff"===e.role);return(0,l.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,l.jsx)("h3",{style:{marginBottom:"15px"},children:"ðŸ“Š Staff Hours Summary"}),(0,l.jsxs)("table",{className:"data-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Staff Name"}),(0,l.jsx)("th",{children:"Teaching Hours"}),(0,l.jsx)("th",{children:"Free Periods"}),(0,l.jsx)("th",{children:"Status"})]})}),(0,l.jsx)("tbody",{children:a.map(s=>{let a=e.staffTimetables[s.name];if(!a)return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:s.name}),(0,l.jsx)("td",{children:"0"}),(0,l.jsx)("td",{children:"30"}),(0,l.jsx)("td",{children:"âš ï¸ Not Assigned"})]},s.id);let t=0,i=0;a.forEach(e=>{e.forEach(e=>{e&&"free"!==e.type?t++:i++})});let r=t>=24?"âœ… Full Load":t>=18?"âš¡ Good":t>0?"âš ï¸ Low Load":"âŒ No Classes";return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:s.name}),(0,l.jsxs)("td",{children:[t,"/30"]}),(0,l.jsxs)("td",{children:[i,"/30"]}),(0,l.jsx)("td",{children:r})]},s.id)})})]})]})}s("acw62")}),a("e3nvF",function(a,t){e(a.exports,"default",()=>n);var l=s("ayMG0"),i=s("acw62");let r=["Monday","Tuesday","Wednesday","Thursday","Friday"];function n({timetable:e,className:s}){if(!e||!e[s])return(0,l.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#64748b"},children:"No timetable available"});let a=e[s];return(console.log("TimetableGrid - className:",s),console.log("TimetableGrid - grid:",a),console.log("TimetableGrid - grid is array?",Array.isArray(a)),Array.isArray(a)&&0!==a.length)?(0,l.jsxs)("div",{id:"timetable-export",className:"timetable-grid",children:[(0,l.jsx)("div",{className:"timetable-header",children:"Day/Period"}),[...Array(6)].map((e,s)=>(0,l.jsxs)("div",{className:"timetable-header",children:["P",s+1]},s)),r.map((e,s)=>a[s]&&Array.isArray(a[s])?(0,l.jsxs)((i&&i.__esModule?i.default:i).Fragment,{children:[(0,l.jsx)("div",{className:"timetable-day",children:e}),a[s].map((e,s)=>(0,l.jsx)("div",{className:`timetable-cell subject-${e&&e.type?e.type.toLowerCase():"free"}`,children:e&&"FREE"!==e.subject?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"subject-name",children:e.subject}),(0,l.jsx)("div",{className:"teacher-name",children:e.teacher})]}):(0,l.jsx)("div",{style:{color:"#94a3b8"},children:"FREE"})},s))]},e):null)]}):(0,l.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#64748b"},children:"Invalid timetable format"})}}),a("hyYFF",function(a,t){e(a.exports,"default",()=>i);var l=s("ayMG0");function i({timetable:e,staffName:s}){let a=["P1","P2","P3","P4","P5","P6"],t=e[s];return(console.log("StaffTimetableGrid - Staff:",s),console.log("StaffTimetableGrid - Available:",Object.keys(e)),t)?(0,l.jsx)("div",{className:"timetable-container",id:"staff-timetable-export",children:(0,l.jsxs)("table",{className:"timetable",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"day-header",children:"DAY/PERIOD"}),a.map(e=>(0,l.jsx)("th",{className:"period-header",children:e},e))]})}),(0,l.jsx)("tbody",{children:["Monday","Tuesday","Wednesday","Thursday","Friday"].map((e,s)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"day-cell",children:e}),a.map((e,a)=>{let i=t[s]?.[a],r=!i||"free"===i.type||"FREE"===i.subject;return(0,l.jsx)("td",{className:`period-cell ${r?"free-period":"class-period"}`,children:r?(0,l.jsx)("div",{className:"period-content free",children:(0,l.jsx)("span",{className:"subject-name",children:"FREE"})}):(0,l.jsxs)("div",{className:"period-content",children:[(0,l.jsx)("span",{className:"subject-name",children:i.subject}),(0,l.jsx)("span",{className:"class-name",children:i.class})]})},e)})]},e))})]})}):(0,l.jsxs)("div",{style:{padding:"40px",textAlign:"center"},children:[(0,l.jsx)("div",{style:{fontSize:"48px",marginBottom:"20px"},children:"âš ï¸"}),(0,l.jsx)("h3",{children:"No Timetable Found"}),(0,l.jsxs)("p",{style:{color:"#64748b"},children:['No timetable for "',s,'"']}),(0,l.jsxs)("p",{style:{color:"#64748b",fontSize:"14px"},children:["Available: ",Object.keys(e).join(", ")]})]})}s("acw62")}),a("bU9CP",function(s,a){e(s.exports,"TimetableGenerator",()=>t);class t{constructor(e,s,a){this.classes=e||[],this.staff=s||[],this.subjects=a||[],this.classTimetables={},this.staffTimetables={},this.teacherBusySlots={},this.teacherWeeklyCount={},this.teacherDailyCount={},this.subjectLastUsed={},this.DAYS=["Monday","Tuesday","Wednesday","Thursday","Friday"],this.PERIODS=6,this.MAX_TEACHER_HOURS_PER_DAY=6,this.MAX_TEACHER_HOURS_PER_WEEK=30}validate(){let e=[];if(this.classes&&0!==this.classes.length||e.push("No classes added"),this.staff&&0!==this.staff.filter(e=>"staff"===e.role).length||e.push("No staff added"),this.subjects&&0!==this.subjects.length||e.push("No subjects added"),e.length>0)return{valid:!1,errors:e};let s={};return this.subjects.forEach(e=>{e&&e.className&&e.hoursPerWeek&&(s[e.className]=(s[e.className]||0)+e.hoursPerWeek)}),this.classes.forEach(e=>{if(e&&e.name){let a=s[e.name]||0,t=this.DAYS.length*this.PERIODS;a<t&&console.warn(`Class ${e.name}: Has ${a} hours, target is ${t}. Will fill remaining with revision.`)}}),{valid:!0,warnings:[]}}generate(){try{for(let e of(console.log("ðŸš€ Starting INTELLIGENT timetable generation with 12 priority-based rules..."),this._initialize(),this.classes))e&&e.name&&(console.log(`
\u{1F4CB} Generating timetable for ${e.name}`),this._generateIntelligentTimetable(e.name));this._generateStaffTimetables();let e=this._validateFinal();return console.log("\nâœ… Timetable generation completed successfully"),{success:!0,classTimetables:this.classTimetables,staffTimetables:this.staffTimetables,warnings:e.warnings||[]}}catch(e){return console.error("âŒ Error generating timetable:",e),{success:!1,error:`Error: ${e.message||"Unknown error"}`}}}_initialize(){console.log("âš™ï¸ Initializing timetables..."),this.classes.forEach(e=>{e&&e.name&&(this.classTimetables[e.name]=this.DAYS.map(()=>Array(this.PERIODS).fill(null)))}),this.staff.filter(e=>e&&"staff"===e.role).forEach(e=>{e&&e.name&&(this.teacherBusySlots[e.name]={},this.teacherWeeklyCount[e.name]=0,this.teacherDailyCount[e.name]={},this.DAYS.forEach(s=>{this.teacherDailyCount[e.name][s]=0}))})}_generateIntelligentTimetable(e){try{let s=this.subjects.filter(s=>s&&s.className===e);if(0===s.length)return!0;return s.forEach(e=>{e&&(e.placedHours=0,e.remainingHours=e.hoursPerWeek||0,e.dailyCount={},e.lastPlacedDay=-1,this.DAYS.forEach(s=>{e.dailyCount[s]=0}))}),this.DAYS.forEach((a,t)=>{console.log(`
  \u{1F4C5} ${a}:`);for(let a=0;a<this.PERIODS;a++){if(a>0){let l=this.classTimetables[e][t][a-1];if(l&&l.isLabContinuation){let i=s.find(e=>e.name===l.subject);if(i&&i.currentBlockRemaining>0){this._placeAt(e,t,a,i,!0),i.currentBlockRemaining--,console.log(`    P${a+1}: ${i.name} (continuing lab block)`);continue}}}let l=this._findBestSubjectForSlot(e,t,a,s);if(l){let s=l.isContinuous&&a<=this.PERIODS-(l.blockSize||2);s&&(l.currentBlockRemaining=(l.blockSize||2)-1),this._placeAt(e,t,a,l,s),console.log(`    P${a+1}: ${l.name} ${s?"(lab start)":""}`)}else{let l=this._getRevisionSubject(s);l&&(this.classTimetables[e][t][a]={subject:`${l.name} (Revision)`,teacher:l.teacher,type:l.subjectType||"core"},console.log(`    P${a+1}: ${l.name} (Revision)`))}}}),!0}catch(s){return console.error(`\u{274C} Error generating for ${e}:`,s),!1}}_findBestSubjectForSlot(e,s,a,t){let l=this.DAYS[s],i=[],r=s>0?this.classTimetables[e][s-1][a]:null;for(let n of t){if(!n||!n.name||n.remainingHours<=0)continue;let c=`${l}-P${a+1}`,d=this.teacherBusySlots[n.teacher]?.[c],o=100,h=[];if(r&&r.subject===n.name&&(o-=50,h.push("Same period as yesterday -50")),(n.dailyCount[l]||0)>=2&&(o-=40,h.push("Used too many times today -40")),n.hoursPerWeek>=5&&(n.dailyCount[l]>0||(o+=20,h.push("High-hour subject needs daily appearance +20"))),n.hoursPerWeek<=2&&(0===s||4===s)&&this._hasAvailableMidWeekSlots(e,n,t)&&(o-=30,h.push("Low-hour on Mon/Fri -30")),a>0){let t=this.classTimetables[e][s][a-1];t&&(t.type===n.subjectType?(o-=15,h.push("Same difficulty as previous -15")):(o+=10,h.push("Different difficulty +10")))}let m=n.remainingHours/(n.hoursPerWeek||1);o+=15*m,h.push(`Remaining hours priority +${Math.round(15*m)}`);let u=this.subjectLastUsed[`${e}-${n.name}`];if(u){let e=s*this.PERIODS+a-u.slot;e<3?(o-=25,h.push("Used recently -25")):e>5&&(o+=15,h.push("Not used recently +15"))}if(d&&(o-=100,h.push("Teacher busy -100 (will find alternative if needed)")),n.isContinuous){let t=n.blockSize||2;if(a<=this.PERIODS-t){let l=!0;for(let i=0;i<t;i++)if(this.classTimetables[e][s][a+i]){l=!1;break}l?a>=3&&(o+=20,h.push("Lab in afternoon +20")):(o=-1e3,h.push("Lab block periods not all free"))}else o=-1e3,h.push("Cannot fit lab block")}"core"===n.subjectType&&a<=2&&(o+=10,h.push("Core in morning +10")),"elective"===n.subjectType&&a>=3&&(o+=10,h.push("Elective in afternoon +10")),i.push({subject:n,score:o,reasons:h})}if(i.sort((e,s)=>s.score-e.score),0===i.length||i[0].score<0)return console.log(`    \u{26A0}\u{FE0F} P${a+1}: No ideal subject, using fallback`),t.find(e=>e&&e.remainingHours>0&&!e.isContinuous)||null;let n=i[0];return n.score>0?n.subject:null}_hasAvailableMidWeekSlots(e,s,a){for(let s=1;s<=3;s++)for(let a=0;a<this.PERIODS;a++)if(!this.classTimetables[e][s][a])return!0;return!1}_getRevisionSubject(e){let s=e.filter(e=>e&&"core"===e.subjectType);return s.length>0?(s.sort((e,s)=>s.hoursPerWeek-e.hoursPerWeek),s[0]):e[0]||null}_placeAt(e,s,a,t,l=!1){if(!e||!t||!t.name||!t.teacher)return;let i=this.DAYS[s],r=`${i}-P${a+1}`;this.classTimetables[e][s][a]={subject:t.name,teacher:t.teacher,type:t.subjectType||"core",isLabContinuation:l},t.remainingHours--,t.placedHours++,t.dailyCount[i]=(t.dailyCount[i]||0)+1,t.lastPlacedDay=s,this.subjectLastUsed[`${e}-${t.name}`]={day:s,period:a,slot:s*this.PERIODS+a},this.teacherBusySlots[t.teacher]||(this.teacherBusySlots[t.teacher]={}),this.teacherBusySlots[t.teacher][r]=!0,this.teacherWeeklyCount[t.teacher]=(this.teacherWeeklyCount[t.teacher]||0)+1,this.teacherDailyCount[t.teacher]||(this.teacherDailyCount[t.teacher]={}),this.teacherDailyCount[t.teacher][i]||(this.teacherDailyCount[t.teacher][i]=0),this.teacherDailyCount[t.teacher][i]++}_generateStaffTimetables(){console.log("\nðŸ‘¨â€ðŸ« Generating staff timetables (free periods allowed)..."),this.staff.filter(e=>e&&"staff"===e.role).forEach(e=>{e&&e.name&&(this.staffTimetables[e.name]=this.DAYS.map(()=>Array(this.PERIODS).fill(null).map(()=>({subject:"FREE",class:"-",type:"free"}))))}),this.classes.forEach(e=>{e&&e.name&&this.classTimetables[e.name]&&this.DAYS.forEach((s,a)=>{let t=this.classTimetables[e.name][a];t&&t.forEach((s,t)=>{s&&s.teacher&&this.staffTimetables[s.teacher]&&(this.staffTimetables[s.teacher][a][t]={subject:s.subject,class:e.name,type:s.type})})})})}_validateFinal(){console.log("\nâœ”ï¸ Validating all rules...");let e=[];return this.classes.forEach(s=>{if(!s||!s.name||!this.classTimetables[s.name])return;let a=0;this.DAYS.forEach((e,t)=>{let l=this.classTimetables[s.name][t];l&&l.forEach(e=>{!e&&a++})}),a>0&&e.push(`${s.name}: ${a} empty periods (Rule 9 - should be filled)`)}),{valid:0===e.length,warnings:e}}}});
//# sourceMappingURL=AdminDashboard.1db33003.js.map

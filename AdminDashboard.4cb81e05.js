function e(e,s,t,a){Object.defineProperty(e,s,{get:t,set:a,enumerable:!0,configurable:!0})}var s=globalThis.parcelRequireb79f,t=s.register;t("dXtBz",function(t,a){Object.defineProperty(t.exports,"__esModule",{value:!0,configurable:!0}),e(t.exports,"default",()=>p);var l=s("ayMG0"),i=s("acw62"),r=s("aOD4d"),n=s("2A5UH"),o=s("4XiCD"),d=s("e3nvF"),c=s("hyYFF"),h=s("gqAsg"),m=s("bU9CP"),u=s("fAZ67"),b=s("6AR8M"),f=s("ilpIi");function p({user:e,onLogout:s}){let[t,a]=(0,i.useState)([]),[p,x]=(0,i.useState)([]),[j,y]=(0,i.useState)([]),[g,N]=(0,i.useState)(null),[S,v]=(0,i.useState)([]),[P,C]=(0,i.useState)(!0),[T,k]=(0,i.useState)(!1),[D,w]=(0,i.useState)(!1),[_,I]=(0,i.useState)(!1),[A,E]=(0,i.useState)("classes");(0,i.useEffect)(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);let $=(0,i.useRef)(null),B=(0,i.useRef)(null),[U,R]=(0,i.useState)({name:"",hallNumber:""}),[F,M]=(0,i.useState)({id:null,name:"",username:"",password:"",freePeriodMode:"auto",manualFreePeriods:0}),[W,O]=(0,i.useState)({id:null,className:"",name:"",subjectType:"Core",hoursPerWeek:6,isContinuous:!1,blockSize:2,teacher:""}),L=p.filter(e=>"staff"===e.role),z=(e,s,t=3e3,a=null)=>{let l={message:e,type:s,id:Date.now(),undoAction:a};v(e=>[...e,l]),setTimeout(()=>Y(l.id),t)},Y=e=>{v(s=>s.filter(s=>s.id!==e))},H=e=>{if(!e)return null;let s={};return Object.keys(e).forEach(t=>{let a=e[t];if(Array.isArray(a)&&a.length>0&&Array.isArray(a[0]))s[t]=a;else if(Array.isArray(a)){let e=[[],[],[],[],[]];a.forEach(s=>{s&&"number"==typeof s.day&&"number"==typeof s.period&&(e[s.day]||(e[s.day]=[]),e[s.day][s.period]={subject:s.subject,teacher:s.teacher,class:s.class,type:s.type})}),e.forEach((s,t)=>{e[t]||(e[t]=[]);for(let s=0;s<6;s++)e[t][s]||(e[t][s]=a[0]?.class!==void 0?{subject:"FREE",class:"-",type:"free"}:null)}),s[t]=e}}),s},G=async()=>{C(!0);try{let[e,s,t,l]=await Promise.all([(0,f.getDocs)((0,f.collection)(u.db,"classes")),(0,f.getDocs)((0,f.collection)(u.db,"staff")),(0,f.getDocs)((0,f.collection)(u.db,"subjects")),(0,f.getDocs)((0,f.collection)(u.db,"timetable"))]);if(a(e.docs.map(e=>({id:e.id,...e.data()}))),x(s.docs.map(e=>({id:e.id,...e.data()}))),y(t.docs.map(e=>({id:e.id,...e.data()}))),!l.empty){let e=l.docs[0].data(),s={classTimetables:H(e.classTimetables),staffTimetables:H(e.staffTimetables)};N(s)}}catch(e){z("âŒ Error loading data: "+e.message,"error"),console.error(e)}C(!1)};(0,i.useEffect)(()=>{G()},[]);let V=async e=>{try{if("class"===e.type){let{id:s,...t}=e.data;await (0,f.setDoc)((0,f.doc)(u.db,"classes",s),t)}else if("staff"===e.type){let{id:s,...t}=e.data;await (0,f.setDoc)((0,f.doc)(u.db,"staff",s),t),e.data.firebaseUid&&await (0,f.setDoc)((0,f.doc)(u.db,"users",e.data.firebaseUid),{name:e.data.name,username:e.data.username,role:"staff"})}else if("subject"===e.type){let{id:s,...t}=e.data;await (0,f.setDoc)((0,f.doc)(u.db,"subjects",s),t)}else if("classTimetable"===e.type){let s={...g.classTimetables,[e.className]:e.data},t=(0,f.collection)(u.db,"timetable"),a=await (0,f.getDocs)(t);a.empty||await (0,f.updateDoc)((0,f.doc)(u.db,"timetable",a.docs[0].id),{classTimetables:s}),N({...g,classTimetables:s})}await G(),z("âœ… Data restored!","success")}catch(e){console.error("Restore error:",e),z("âŒ Restore failed: "+e.message,"error")}},q=async()=>{if(!U.name)return z("Enter class name","error");if(t.find(e=>e.name===U.name&&!U.id))return z("Class already exists","error");try{if(U.id)await (0,f.updateDoc)((0,f.doc)(u.db,"classes",U.id),{name:U.name,hallNumber:U.hallNumber}),a(t.map(e=>e.id===U.id?{id:U.id,...U}:e)),z("âœ… Class updated!","success");else{let e=await (0,f.addDoc)((0,f.collection)(u.db,"classes"),{name:U.name,hallNumber:U.hallNumber||""});a([...t,{id:e.id,name:U.name,hallNumber:U.hallNumber||""}]),z("âœ… Class added!","success")}R({name:"",hallNumber:""}),I(!1)}catch(e){z("âŒ Operation failed","error")}},X=async e=>{if(window.confirm("Delete this class?"))try{let s=t.find(s=>s.id===e);if(!s)return;let l={type:"class",data:{...s}};await (0,f.deleteDoc)((0,f.doc)(u.db,"classes",e)),a(t.filter(s=>s.id!==e)),z("âœ… Class deleted","success",5e3,()=>V(l))}catch(e){console.error("Delete error:",e),z("âŒ Failed to delete","error")}},K=async()=>{if(!F.name||!F.username)return z("Fill all required fields","error");try{if(F.id){let e=p.find(e=>e.id===F.id),{password:s,...t}=F,a={name:t.name,freePeriodMode:t.freePeriodMode,manualFreePeriods:t.manualFreePeriods};e.username!==t.username&&(a.username=t.username),await (0,f.updateDoc)((0,f.doc)(u.db,"staff",F.id),a),e.firebaseUid&&await (0,f.updateDoc)((0,f.doc)(u.db,"users",e.firebaseUid),{name:F.name,username:F.username,role:"staff"}),s&&s.trim()?(await (0,f.updateDoc)((0,f.doc)(u.db,"staff",F.id),{tempPassword:s,passwordLastChanged:new Date().toISOString(),needsPasswordChange:!0}),z("âœ… Temporary password set. Share it with staff.","success")):z("âœ… Staff updated!","success"),x(p.map(e=>e.id===F.id?{...e,...a}:e)),J(),k(!1);return}if(!F.password)return z("Password required","error");let e=`${F.username}@timetable.com`,s=(await (0,b.createUserWithEmailAndPassword)(u.auth,e,F.password)).user.uid,t={name:F.name,username:F.username,freePeriodMode:F.freePeriodMode,manualFreePeriods:F.manualFreePeriods,role:"staff",firebaseUid:s},a=await (0,f.addDoc)((0,f.collection)(u.db,"staff"),t);await (0,f.setDoc)((0,f.doc)(u.db,"users",s),{name:F.name,username:F.username,role:"staff"}),x([...p,{id:a.id,...t}]),J(),k(!1),z("âœ… Staff added!","success")}catch(e){z("âŒ Operation failed: "+e.message,"error"),console.error(e)}},J=()=>{M({id:null,name:"",username:"",password:"",freePeriodMode:"auto",manualFreePeriods:0})},Z=async e=>{if(window.confirm("Delete this staff member?"))try{let s=p.find(s=>s.id===e);if(!s)return;let t={type:"staff",data:{...s}};await (0,f.deleteDoc)((0,f.doc)(u.db,"staff",e)),s.firebaseUid&&await (0,f.deleteDoc)((0,f.doc)(u.db,"users",s.firebaseUid)),x(p.filter(s=>s.id!==e)),z("âœ… Staff deleted","success",5e3,()=>V(t))}catch(e){console.error("Delete staff error:",e),z("âŒ Failed to delete","error")}},Q=async()=>{if(!W.className||!W.name||!W.teacher)return z("Fill all required fields","error");try{let e={className:W.className,name:W.name,subjectType:W.subjectType,hoursPerWeek:W.hoursPerWeek,isContinuous:W.isContinuous,blockSize:W.blockSize,teacher:W.teacher};if(W.id)await (0,f.updateDoc)((0,f.doc)(u.db,"subjects",W.id),e),y(j.map(s=>s.id===W.id?{id:W.id,...e}:s)),z("âœ… Subject updated!","success");else{let s=await (0,f.addDoc)((0,f.collection)(u.db,"subjects"),e);y([...j,{id:s.id,...e}]),z("âœ… Subject added!","success")}ee(),w(!1)}catch(e){z("âŒ Operation failed","error"),console.error(e)}},ee=()=>{O({id:null,className:"",name:"",subjectType:"Core",hoursPerWeek:6,isContinuous:!1,blockSize:2,teacher:""})},es=async e=>{if(window.confirm("Delete this subject?"))try{let s=j.find(s=>s.id===e);if(!s)return;let t={type:"subject",data:{...s}};await (0,f.deleteDoc)((0,f.doc)(u.db,"subjects",e)),y(j.filter(s=>s.id!==e)),z("âœ… Subject deleted","success",5e3,()=>V(t))}catch(e){console.error("Delete subject error:",e),z("âŒ Failed to delete","error")}},et=async e=>{if(window.confirm(`Delete timetable for ${e}?
This will only delete the class timetable, not staff timetables.`))try{if(!g||!g.classTimetables||!g.classTimetables[e])return z("Timetable not found","error");let s=g.classTimetables[e],t={type:"classTimetable",className:e,data:s},a={...g.classTimetables};delete a[e];let l=(0,f.collection)(u.db,"timetable"),i=await (0,f.getDocs)(l);i.empty||await (0,f.updateDoc)((0,f.doc)(u.db,"timetable",i.docs[0].id),{classTimetables:a}),N({...g,classTimetables:a}),z(`Timetable for ${e} deleted`,"success",5e3,()=>V(t))}catch(e){console.error("Delete timetable error:",e),z("Failed to delete timetable","error")}},ea=async()=>{C(!0);try{let e=new(0,m.TimetableGenerator)(t,p.filter(e=>"staff"===e.role),j),s=e.validate();if(!s.valid){z("âŒ Validation: "+s.errors[0],"error"),C(!1);return}let a=e.generate();if(a.success){let e={},s={};Object.keys(a.classTimetables).forEach(s=>{e[s]=a.classTimetables[s].map((e,s)=>e.map((e,t)=>({day:s,period:t,subject:e?.subject||null,teacher:e?.teacher||null,type:e?.type||null}))).flat()}),Object.keys(a.staffTimetables).forEach(e=>{s[e]=a.staffTimetables[e].map((e,s)=>e.map((e,t)=>({day:s,period:t,subject:e?.subject||null,class:e?.class||null,type:e?.type||null}))).flat()});let t={classTimetables:e,staffTimetables:s,generatedAt:new Date().toISOString()},l=(0,f.collection)(u.db,"timetable"),i=await (0,f.getDocs)(l);for(let e of(i.empty?await (0,f.addDoc)(l,t):await (0,f.updateDoc)((0,f.doc)(u.db,"timetable",i.docs[0].id),t),p.filter(e=>"staff"===e.role))){let t=s[e.name];t&&await (0,f.setDoc)((0,f.doc)(u.db,"staffTimetables",e.id),{staffName:e.name,timetable:t,generatedAt:new Date().toISOString()})}let r={};Object.keys(e).forEach(s=>{let t=[[],[],[],[],[]];e[s].forEach(e=>{t[e.day]||(t[e.day]=[]),t[e.day][e.period]={subject:e.subject,teacher:e.teacher,type:e.type}}),t.forEach((e,s)=>{t[s]||(t[s]=[]);for(let e=0;e<6;e++)t[s][e]||(t[s][e]=null)}),r[s]=t});let n={};Object.keys(s).forEach(e=>{let t=[[],[],[],[],[]];s[e].forEach(e=>{t[e.day]||(t[e.day]=[]),t[e.day][e.period]={subject:e.subject,class:e.class,type:e.type}}),t.forEach((e,s)=>{t[s]||(t[s]=[]);for(let e=0;e<6;e++)t[s][e]||(t[s][e]={subject:"FREE",class:"-",type:"free"})}),n[e]=t}),N({classTimetables:r,staffTimetables:n}),E("results"),z("âœ… Timetable generated & saved!","success"),setTimeout(()=>{document.getElementById("view-timetables")?.scrollIntoView({behavior:"smooth"})},300)}else z("âŒ Failed: "+a.error,"error")}catch(e){z("âŒ Error: "+e.message,"error"),console.error(e)}C(!1)};return P?(0,l.jsx)(r.default,{variant:"spiral",colorScheme:"gradient",interactive:!0,children:(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",color:"white",fontSize:"24px",gap:"20px"},children:[(0,l.jsx)("div",{className:"spinner"}),(0,l.jsx)("div",{children:"Loading..."})]})}):(0,l.jsx)(r.default,{variant:"spiral",colorScheme:"gradient",interactive:!0,children:(0,l.jsxs)("div",{className:"min-h-screen relative z-10 text-white",children:[(0,l.jsxs)("div",{className:"header-content",children:[(0,l.jsx)("h1",{className:"text-white",children:"Admin Dashboard"}),(0,l.jsx)("div",{className:"header-actions",children:(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:s,children:"Logout"})})]}),(0,l.jsxs)("div",{className:"segmented-nav",children:[(0,l.jsx)("button",{className:`segmented-item ${"classes"===A?"active":""}`,onClick:()=>{E("classes"),document.getElementById("classes-section")?.scrollIntoView({behavior:"smooth"})},children:"Classes"}),(0,l.jsx)("button",{className:`segmented-item ${"staff"===A?"active":""}`,onClick:()=>{E("staff"),document.getElementById("staff-section")?.scrollIntoView({behavior:"smooth"})},children:"Staff"}),(0,l.jsx)("button",{className:`segmented-item ${"subjects"===A?"active":""}`,onClick:()=>{E("subjects"),document.getElementById("subject-section")?.scrollIntoView({behavior:"smooth"})},children:"Subjects"}),(0,l.jsx)("button",{className:`segmented-item ${"generate"===A?"active":""}`,onClick:()=>{E("generate"),document.getElementById("generate-section")?.scrollIntoView({behavior:"smooth"})},children:"Generate"}),(0,l.jsx)("button",{className:`segmented-item ${"results"===A?"active":""}`,onClick:()=>{E("results"),document.getElementById("view-timetables")?.scrollIntoView({behavior:"smooth"})},children:"Results"})]}),(0,l.jsxs)("div",{className:"content",children:[(0,l.jsxs)("div",{className:"section",id:"classes-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“š"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Classes"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("h3",{children:["Existing Classes (",t.length,")"]}),0===t.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"No classes added yet"}):(0,l.jsx)(l.Fragment,{children:[...t].sort((e,s)=>e.name.localeCompare(s.name)).map(e=>{let s=j.filter(s=>s.className===e.name),t=s.reduce((e,s)=>e+s.hoursPerWeek,0),a=t/30*100;return(0,l.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,l.jsxs)("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",color:"#1e293b",flexWrap:"wrap"},children:[(0,l.jsxs)("h4",{style:{margin:0,display:"flex",alignItems:"center",gap:"8px"},children:["Class ",(0,l.jsx)("strong",{children:e.name})]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px",color:"#64748b",fontWeight:600},children:[(0,l.jsxs)("span",{children:[t,"/30 hours"]}),(0,l.jsxs)("span",{children:[Math.max(30-t,0),"h remaining"]})]})]}),(0,l.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden",marginBottom:"15px"},children:(0,l.jsx)("div",{style:{height:"100%",width:`${Math.min(a,100)}%`,backgroundColor:30===t?"#10b981":"#f59e0b",transition:"width 0.3s ease"}})}),(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Hall Number"}),(0,l.jsx)("th",{children:"Subjects"}),(0,l.jsx)("th",{children:"Hours"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.hallNumber||"-"}),(0,l.jsx)("td",{children:s.length}),(0,l.jsx)("td",{children:(0,l.jsxs)("span",{className:`badge ${30===t?"badge-success":"badge-danger"}`,children:[t,"/30h"]})}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>{R({id:e.id,name:e.name,hallNumber:e.hallNumber||""}),I(!0),window.scrollTo({top:0,behavior:"smooth"})},title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>X(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]})})]})})]},e.id)})}),(0,l.jsx)("button",{className:"btn btn-success btn-sm",onClick:()=>{I(!0),R({id:null,name:"",hallNumber:""})},style:{marginTop:"15px"},children:"Add Class"})]}),_&&(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:U.id?"Edit Class":"Add New Class"}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Class Name"}),(0,l.jsx)("input",{type:"text",value:U.name,onChange:e=>R({...U,name:e.target.value.toUpperCase()}),placeholder:"CS3A, EE2B"})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Hall Number (Optional)"}),(0,l.jsx)("input",{type:"text",value:U.hallNumber,onChange:e=>R({...U,hallNumber:e.target.value}),placeholder:"Hall 101"})]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:q,children:U.id?"Update Class":"Add Class"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{R({name:"",hallNumber:""}),I(!1)},children:"Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",id:"staff-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ‘¥"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Staff"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("h3",{children:["Existing Staff (",L.length,")"]}),0===L.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"No staff added yet"}):(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"S.No"}),(0,l.jsx)("th",{children:"Name"}),(0,l.jsx)("th",{children:"Username"}),(0,l.jsx)("th",{children:"Free Periods"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:L.map((e,s)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:(0,l.jsxs)("span",{className:"staff-badge",children:["S",s+1]})}),(0,l.jsx)("td",{children:(0,l.jsx)("strong",{children:e.name})}),(0,l.jsx)("td",{children:e.username}),(0,l.jsx)("td",{children:"manual"===e.freePeriodMode?`Manual (${e.manualFreePeriods} free periods)`:"Auto"}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>{M({...e,password:""}),k(!0),setTimeout(()=>{$.current?.scrollIntoView({behavior:"smooth",block:"center"})},100)},title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>Z(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]},e.id))})]})}),(0,l.jsx)("button",{className:"btn btn-success btn-sm",onClick:()=>{k(!0),J()},style:{marginTop:"15px"},children:"Add Staff"})]}),T&&(0,l.jsxs)("div",{className:"card",ref:$,children:[(0,l.jsx)("h3",{children:F.id?"Edit Staff":"Add New Staff"}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Full Name"}),(0,l.jsx)("input",{type:"text",placeholder:"Dr. John Doe",value:F.name,onChange:e=>M({...F,name:e.target.value})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Username"}),(0,l.jsx)("input",{type:"text",placeholder:"john",value:F.username,onChange:e=>M({...F,username:e.target.value})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:F.id?"New Password (Optional)":"Password"}),(0,l.jsx)("input",{type:"password",placeholder:F.id?"Leave blank to keep current":"Enter password",value:F.password,onChange:e=>M({...F,password:e.target.value})}),F.id&&(0,l.jsx)("small",{style:{color:"#64748b",display:"block",marginTop:"4px"},children:"Staff can use new password immediately on next login"})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Free Period Mode"}),(0,l.jsxs)("select",{value:F.freePeriodMode,onChange:e=>M({...F,freePeriodMode:e.target.value}),children:[(0,l.jsx)("option",{value:"auto",children:"Auto"}),(0,l.jsx)("option",{value:"manual",children:"Manual"})]})]}),"manual"===F.freePeriodMode&&(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Free Periods per Week"}),(0,l.jsx)("input",{type:"number",min:"0",max:"30",value:F.manualFreePeriods,onChange:e=>M({...F,manualFreePeriods:parseInt(e.target.value)||0})})]})]}),(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:K,children:F.id?"Save Changes":"Add Staff"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{J(),k(!1)},children:"Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",id:"subject-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“–"}),(0,l.jsx)("h2",{className:"section-title",children:"Manage Subjects"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("h3",{children:["Existing Subjects (",j.length,")"]}),0===j.length?(0,l.jsx)("p",{style:{color:"#64748b",textAlign:"center",padding:"20px"},children:"No subjects added yet"}):(0,l.jsx)(l.Fragment,{children:t.map(e=>{let s=j.filter(s=>s.className===e.name);if(0===s.length)return null;let t=s.reduce((e,s)=>e+s.hoursPerWeek,0),a=t/30*100;return(0,l.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,l.jsxs)("div",{style:{marginBottom:"8px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px",color:"#1e293b",flexWrap:"wrap"},children:[(0,l.jsxs)("h4",{style:{margin:0,display:"flex",alignItems:"center",gap:"8px"},children:["Class ",(0,l.jsx)("strong",{children:e.name})]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px",color:"#64748b",fontWeight:600},children:[(0,l.jsxs)("span",{children:[t,"/30 hours"]}),(0,l.jsxs)("span",{children:[Math.max(30-t,0),"h remaining"]})]})]}),(0,l.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden",marginBottom:"15px"},children:(0,l.jsx)("div",{style:{height:"100%",width:`${Math.min(a,100)}%`,backgroundColor:30===t?"#10b981":"#f59e0b",transition:"width 0.3s ease"}})}),(0,l.jsx)("div",{className:"desktop-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Subject"}),(0,l.jsx)("th",{children:"Type"}),(0,l.jsx)("th",{children:"Hours"}),(0,l.jsx)("th",{children:"Teacher"}),(0,l.jsx)("th",{children:"Continuous"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:s.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:(0,l.jsx)("strong",{children:e.name})}),(0,l.jsx)("td",{children:e.subjectType}),(0,l.jsxs)("td",{children:[e.hoursPerWeek,"h"]}),(0,l.jsx)("td",{children:e.teacher}),(0,l.jsx)("td",{children:e.isContinuous?`Yes (${e.blockSize}p)`:"No"}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{className:"action-buttons",children:[(0,l.jsx)("button",{className:"btn-icon btn-icon-primary",onClick:()=>{O({id:e.id,className:e.className,name:e.name,subjectType:e.subjectType,hoursPerWeek:e.hoursPerWeek,isContinuous:e.isContinuous||!1,blockSize:e.blockSize||2,teacher:e.teacher}),w(!0),setTimeout(()=>{B.current?.scrollIntoView({behavior:"smooth",block:"center"})},100)},title:"Edit",children:"âœï¸"}),(0,l.jsx)("button",{className:"btn-icon btn-icon-danger",onClick:()=>es(e.id),title:"Delete",children:"ðŸ—‘ï¸"})]})})]},e.id))})]})})]},e.id)})}),(0,l.jsx)("button",{className:"btn btn-success btn-sm",onClick:()=>{w(!0),ee()},style:{marginTop:"15px"},children:"Add Subject"})]}),D&&(0,l.jsxs)("div",{className:"card",ref:B,children:[(0,l.jsx)("h3",{children:W.id?"Edit Subject":"Add New Subject"}),W.className&&(0,l.jsx)(o.default,{className:W.className,subjects:j}),(0,l.jsxs)("div",{className:"grid-2",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Select Class"}),(0,l.jsxs)("select",{value:W.className,onChange:e=>O({...W,className:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"-- Select Class --"}),t.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Subject Name"}),(0,l.jsx)("input",{type:"text",value:W.name,onChange:e=>O({...W,name:e.target.value}),placeholder:"DBMS, AI Lab, etc."})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Subject Type"}),(0,l.jsxs)("select",{value:W.subjectType,onChange:e=>O({...W,subjectType:e.target.value}),children:[(0,l.jsx)("option",{value:"Core",children:"Core"}),(0,l.jsx)("option",{value:"Elective",children:"Elective"}),(0,l.jsx)("option",{value:"Lab",children:"Lab"}),(0,l.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Hours per Week"}),(0,l.jsx)("input",{type:"number",min:"1",max:"30",value:W.hoursPerWeek,onChange:e=>O({...W,hoursPerWeek:parseInt(e.target.value)||6})})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Teacher"}),(0,l.jsxs)("select",{value:W.teacher,onChange:e=>O({...W,teacher:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"-- Select Teacher --"}),L.map(e=>(0,l.jsx)("option",{value:e.name,children:e.name},e.id))]})]})]}),(0,l.jsxs)("div",{className:"checkbox-group",children:[(0,l.jsx)("input",{type:"checkbox",id:"continuous",checked:W.isContinuous,onChange:e=>O({...W,isContinuous:e.target.checked})}),(0,l.jsx)("label",{htmlFor:"continuous",style:{marginBottom:0},children:"Continuous Period (Lab)"})]}),W.isContinuous&&(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:"Block Size"}),(0,l.jsxs)("select",{value:W.blockSize,onChange:e=>O({...W,blockSize:parseInt(e.target.value)}),children:[(0,l.jsx)("option",{value:"2",children:"2 Periods"}),(0,l.jsx)("option",{value:"3",children:"3 Periods"})]})]}),(0,l.jsxs)("div",{className:"button-group",children:[(0,l.jsx)("button",{className:"btn btn-primary",onClick:Q,children:W.id?"Save Changes":"Add Subject"}),(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>{ee(),w(!1)},children:"Cancel"})]})]})]}),(0,l.jsxs)("div",{className:"section",id:"generate-section",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"âš¡"}),(0,l.jsx)("h2",{className:"section-title",children:"Generate Timetable"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Ready to Generate"}),(0,l.jsxs)("div",{className:"stats-grid",children:[(0,l.jsxs)("div",{className:"stat-card stat-primary",children:[(0,l.jsx)("div",{className:"stat-label",children:"Classes"}),(0,l.jsx)("div",{className:"stat-value",children:t.length})]}),(0,l.jsxs)("div",{className:"stat-card stat-success",children:[(0,l.jsx)("div",{className:"stat-label",children:"Teachers"}),(0,l.jsx)("div",{className:"stat-value",children:L.length})]}),(0,l.jsxs)("div",{className:"stat-card stat-warning",children:[(0,l.jsx)("div",{className:"stat-label",children:"Subjects"}),(0,l.jsx)("div",{className:"stat-value",children:j.length})]})]}),(0,l.jsx)("button",{className:"btn btn-success btn-lg",onClick:ea,disabled:P,children:P?"Generating...":"Generate Timetable"})]})]}),g&&(0,l.jsxs)("div",{className:"section",id:"view-timetables",children:[(0,l.jsxs)("div",{className:"section-header",children:[(0,l.jsx)("span",{className:"section-icon",children:"ðŸ“Š"}),(0,l.jsx)("h2",{className:"section-title",children:"Generated Timetables"})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Class Timetables"}),[...t].sort((e,s)=>e.name.localeCompare(s.name)).map(e=>(0,l.jsxs)("div",{className:"timetable-container",id:`timetable-export-${e.id}`,children:[(0,l.jsx)("h4",{className:"timetable-title",children:e.name}),(0,l.jsx)("div",{className:"timetable-scroll",children:(0,l.jsx)(d.default,{timetable:g.classTimetables,className:e.name})}),(0,l.jsxs)("div",{className:"timetable-actions no-print no-export",children:[(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>(0,h.exportToPDF)(`timetable-export-${e.id}`,`${e.name}_Timetable.pdf`,{title:e.name}),children:"Download PDF"}),(0,l.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>et(e.name),title:`Delete ${e.name} timetable`,children:"ðŸ—‘ï¸ Delete"})]})]},e.id))]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"Staff-wise Timetables"}),[...L].sort((e,s)=>e.name.localeCompare(s.name)).map(e=>(0,l.jsxs)("div",{className:"timetable-container",id:`staff-timetable-export-${e.id}`,children:[(0,l.jsxs)("h4",{className:"timetable-title",children:["Teacher: ",e.name]}),(0,l.jsx)("div",{className:"timetable-scroll",children:(0,l.jsx)(c.default,{timetable:g.staffTimetables,staffName:e.name})}),(0,l.jsx)("div",{className:"timetable-actions no-print no-export",children:(0,l.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>(0,h.exportToPDF)(`staff-timetable-export-${e.id}`,`${e.name}_Timetable.pdf`,{title:`Staff Timetable: ${e.name}`}),children:"Download PDF"})})]},e.id))]})]})]}),(0,l.jsx)(n.ToastContainer,{toasts:S,onRemove:Y})]})})}}),t("2A5UH",function(t,a){e(t.exports,"ToastContainer",()=>r);var l=s("ayMG0");s("acw62");let i=({id:e,message:s,type:t,onRemove:a,undoAction:i})=>(0,l.jsxs)("div",{style:{padding:"12px 16px",borderRadius:"8px",marginBottom:"10px",background:"error"===t?"#ff4444":"success"===t?"#00C851":"#ffbb33",color:"white",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",animation:"slideIn 0.3s ease-out"},children:[(0,l.jsx)("span",{children:s}),(0,l.jsxs)("div",{style:{display:"flex",gap:"8px",marginLeft:"16px"},children:[i&&(0,l.jsx)("button",{onClick:()=>{"function"==typeof i&&i(),"function"==typeof a&&a(e)},style:{background:"white",color:"success"===t?"#00C851":"#333",border:"none",padding:"4px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"13px",fontWeight:"600"},children:"UNDO"}),(0,l.jsx)("button",{onClick:()=>{"function"==typeof a&&a(e)},style:{background:"transparent",border:"none",color:"white",cursor:"pointer",fontSize:"18px",padding:"0 4px",lineHeight:"1"},title:"Close",children:"Ã—"})]})]}),r=({toasts:e,onRemove:s})=>(0,l.jsx)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,minWidth:"300px",maxWidth:"500px"},children:e.map(e=>(0,l.jsx)(i,{id:e.id,message:e.message,type:e.type,onRemove:s,undoAction:e.undoAction},e.id))})}),t("4XiCD",function(t,a){e(t.exports,"default",()=>i);var l=s("ayMG0");function i({timetable:e,staff:s}){if(!e||!e.staffTimetables)return null;let t=s.filter(e=>"staff"===e.role);return(0,l.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,l.jsx)("h3",{style:{marginBottom:"15px"},children:"ðŸ“Š Staff Hours Summary"}),(0,l.jsxs)("table",{className:"data-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Staff Name"}),(0,l.jsx)("th",{children:"Teaching Hours"}),(0,l.jsx)("th",{children:"Free Periods"}),(0,l.jsx)("th",{children:"Status"})]})}),(0,l.jsx)("tbody",{children:t.map(s=>{let t=e.staffTimetables[s.name];if(!t)return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:s.name}),(0,l.jsx)("td",{children:"0"}),(0,l.jsx)("td",{children:"30"}),(0,l.jsx)("td",{children:"âš ï¸ Not Assigned"})]},s.id);let a=0,i=0;t.forEach(e=>{e.forEach(e=>{e&&"free"!==e.type?a++:i++})});let r=a>=24?"âœ… Full Load":a>=18?"âš¡ Good":a>0?"âš ï¸ Low Load":"âŒ No Classes";return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:s.name}),(0,l.jsxs)("td",{children:[a,"/30"]}),(0,l.jsxs)("td",{children:[i,"/30"]}),(0,l.jsx)("td",{children:r})]},s.id)})})]})]})}s("acw62")}),t("e3nvF",function(t,a){e(t.exports,"default",()=>n);var l=s("ayMG0"),i=s("acw62");let r=["Monday","Tuesday","Wednesday","Thursday","Friday"];function n({timetable:e,className:s}){if(!e||!e[s])return(0,l.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#64748b"},children:"No timetable available"});let t=e[s];return(console.log("TimetableGrid - className:",s),console.log("TimetableGrid - grid:",t),console.log("TimetableGrid - grid is array?",Array.isArray(t)),Array.isArray(t)&&0!==t.length)?(0,l.jsxs)("div",{id:"timetable-export",className:"timetable-grid",children:[(0,l.jsx)("div",{className:"timetable-header",children:"Day/Period"}),[...Array(6)].map((e,s)=>(0,l.jsxs)("div",{className:"timetable-header",children:["P",s+1]},s)),r.map((e,s)=>t[s]&&Array.isArray(t[s])?(0,l.jsxs)((i&&i.__esModule?i.default:i).Fragment,{children:[(0,l.jsx)("div",{className:"timetable-day",children:e}),t[s].map((e,s)=>(0,l.jsx)("div",{className:`timetable-cell subject-${e&&e.type?e.type.toLowerCase():"free"}`,children:e&&"FREE"!==e.subject?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"subject-name",children:e.subject}),(0,l.jsx)("div",{className:"teacher-name",children:e.teacher})]}):(0,l.jsx)("div",{style:{color:"#94a3b8"},children:"FREE"})},s))]},e):null)]}):(0,l.jsx)("div",{style:{padding:"40px",textAlign:"center",color:"#64748b"},children:"Invalid timetable format"})}}),t("hyYFF",function(t,a){e(t.exports,"default",()=>i);var l=s("ayMG0");function i({timetable:e,staffName:s}){let t=["P1","P2","P3","P4","P5","P6"],a=e[s];return(console.log("StaffTimetableGrid - Staff:",s),console.log("StaffTimetableGrid - Available:",Object.keys(e)),a)?(0,l.jsx)("div",{className:"timetable-container",id:"staff-timetable-export",children:(0,l.jsxs)("table",{className:"timetable",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"day-header",children:"DAY/PERIOD"}),t.map(e=>(0,l.jsx)("th",{className:"period-header",children:e},e))]})}),(0,l.jsx)("tbody",{children:["Monday","Tuesday","Wednesday","Thursday","Friday"].map((e,s)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"day-cell",children:e}),t.map((e,t)=>{let i=a[s]?.[t],r=!i||"free"===i.type||"FREE"===i.subject;return(0,l.jsx)("td",{className:`period-cell ${r?"free-period":"class-period"}`,children:r?(0,l.jsx)("div",{className:"period-content free",children:(0,l.jsx)("span",{className:"subject-name",children:"FREE"})}):(0,l.jsxs)("div",{className:"period-content",children:[(0,l.jsx)("span",{className:"subject-name",children:i.subject}),(0,l.jsx)("span",{className:"class-name",children:i.class})]})},e)})]},e))})]})}):(0,l.jsxs)("div",{style:{padding:"40px",textAlign:"center"},children:[(0,l.jsx)("div",{style:{fontSize:"48px",marginBottom:"20px"},children:"âš ï¸"}),(0,l.jsx)("h3",{children:"No Timetable Found"}),(0,l.jsxs)("p",{style:{color:"#64748b"},children:['No timetable for "',s,'"']}),(0,l.jsxs)("p",{style:{color:"#64748b",fontSize:"14px"},children:["Available: ",Object.keys(e).join(", ")]})]})}s("acw62")}),t("bU9CP",function(s,t){e(s.exports,"TimetableGenerator",()=>a);class a{constructor(e,s,t){this.classes=e||[],this.staff=s||[],this.subjects=t||[],this.classTimetables={},this.staffTimetables={},this.teacherSlots={},this.DAYS=["Monday","Tuesday","Wednesday","Thursday","Friday"],this.PERIODS=6,this.TOTAL_HOURS=30,this.MAX_TEACHER_HOURS=30,this.globalLabDayCount={},this._seed=Date.now(),this.maxRetries=5}_random(){return this._seed=(1664525*this._seed+0x3c6ef35f)%0x100000000,this._seed/0x100000000}_shuffle(e){let s=[...e];for(let e=s.length-1;e>0;e--){let t=Math.floor(this._random()*(e+1));[s[e],s[t]]=[s[t],s[e]]}return s}_pickRandomFromTopN(e,s=5){if(!e.length)return null;let t=e.slice(0,Math.min(s,e.length));return t[Math.floor(this._random()*t.length)]}_getBaseSubjectName(e=""){return e.replace(/\s+lab$/i,"").trim().toLowerCase()}_isSameBase(e="",s=""){return this._getBaseSubjectName(e)===this._getBaseSubjectName(s)}_zone(e){return e<=1?"Early":e<=3?"Mid":"Late"}validate(){let e=[];for(let s of(this.classes.length||e.push("No classes defined"),this.staff.filter(e=>e?.role==="staff").length||e.push("No staff defined"),this.subjects.length||e.push("No subjects defined"),this.classes))this.subjects.filter(e=>e?.className===s.name).reduce((e,s)=>e+(s.hoursPerWeek||0),0)!==this.TOTAL_HOURS&&e.push('Class "${cls.name}": total hours ${total} != required ${this.TOTAL_HOURS}');let s={};for(let e of this.subjects)e.teacher&&"-"!==e.teacher&&(s[e.teacher]=(s[e.teacher]||0)+(e.hoursPerWeek||0));for(let[t,a]of Object.entries(s))a>this.MAX_TEACHER_HOURS&&e.push('Teacher "${t}" overload: ${h}h > ${this.MAX_TEACHER_HOURS}h');return e.length?{valid:!1,errors:e}:{valid:!0}}_getClassComplexity(e){let s=this.subjects.filter(s=>s.className===e);return 10*s.filter(e=>e.isContinuous).length+5*new Set(s.map(e=>e.teacher)).size+s.length}generate(){console.log("TimetableGenerator: start generate");let e=this.validate();if(!e.valid)return console.error("Validation failed:",e.errors),{success:!1,error:e.errors.join("; ")};for(let e=0;e<this.maxRetries;e++){console.log("Generation attempt ${attempt + 1}/${this.maxRetries}"),this._seed=Date.now()+1e3*e,this.classTimetables={},this.teacherSlots={},this.globalLabDayCount={},this.classes.forEach(e=>this.classTimetables[e.name]=this.DAYS.map(()=>Array(this.PERIODS).fill(null))),this.staff.forEach(e=>this.teacherSlots[e.name]={}),this.DAYS.forEach(e=>this.globalLabDayCount[e]=0);let s=[...this.classes].sort((e,s)=>this._getClassComplexity(s.name)-this._getClassComplexity(e.name)),t=!0;for(let e of s)if(console.log("Generating for class",e.name),!this._generateForClass(e.name)){console.error("Failed to generate for class ${cls.name} (attempt ${attempt + 1})"),t=!1;break}if(t)return this._buildStaffTimetables(),this._validateTeacherConflicts(),console.log("âœ“ Generation successful!"),{success:!0,classTimetables:this.classTimetables,staffTimetables:this.staffTimetables}}return console.error("Failed to generate timetable after all attempts"),{success:!1,error:"Unable to generate valid timetable after multiple attempts"}}_buildStaffTimetables(){for(let e of(this.staffTimetables={},this.staff))e?.name&&(this.staffTimetables[e.name]=this.DAYS.map(()=>Array(this.PERIODS).fill({subject:"FREE",class:"-",type:"free"})));for(let[e,s]of Object.entries(this.classTimetables))s.forEach((s,t)=>{s.forEach((s,a)=>{s&&s.teacher&&"-"!==s.teacher&&this.staffTimetables[s.teacher]&&(this.staffTimetables[s.teacher][t][a]={subject:s.subject,class:e,type:s.type||"core"})})})}_validateTeacherConflicts(){let e=0;for(let[s,t]of Object.entries(this.teacherSlots)){let s={};for(let a of Object.keys(t))s[a]=(s[a]||0)+1,s[a]>1&&(console.error("Teacher conflict: ${teacher} at ${k}"),e++)}e||console.log("No teacher conflicts")}_generateForClass(e){let s=this.subjects.filter(s=>s.className===e);if(!s.length)return!0;let t=s.filter(e=>!!e.isContinuous),a=s.filter(e=>!e.isContinuous),l=this.classTimetables[e],i={daysUsed:{},dayPeriodMap:{},periodWeeklyCount:{},zonesUsed:{},hoursPlaced:{},lastPeriod:{},subjectBaseDays:{}};for(let e of a){i.daysUsed[e.name]=new Set,i.dayPeriodMap[e.name]={},i.periodWeeklyCount[e.name]=Array(this.PERIODS).fill(0),i.zonesUsed[e.name]=new Set,i.hoursPlaced[e.name]=0,i.lastPeriod[e.name]=-1;let s=this._getBaseSubjectName(e.name);i.subjectBaseDays[s]=i.subjectBaseDays[s]||new Set}let r={daysUsedByLab:{},periodsUsedByLab:{},blockUsageCount:{},hoursPlaced:{},lastDayIdx:{}},n={};for(let e=0;e<this.DAYS.length;e++)n[e]=0;for(let e of t)r.daysUsedByLab[e.name]=new Set,r.periodsUsedByLab[e.name]=new Set,r.blockUsageCount[e.name]={},r.hoursPlaced[e.name]=0,r.lastDayIdx[e.name]=-1;for(let s of t){let t=s.hoursPerWeek||0,a=Math.floor(t/2);for(let t=0;t<a;t++){if(!this._placeLabBlock_withMaxPerDay(e,s,l,r,n))return console.error("Impossible to place lab block for ${lab.name} in class ${className}"),!1;r.hoursPlaced[s.name]+=2}t%2==1&&(this._placeLabSingle_withMaxPerDay(e,s,l,r,n)?r.hoursPlaced[s.name]+=1:console.warn("Single lab hour could not be placed immediately for ${lab.name} (class ${className})"))}let o=a.filter(e=>(e.hoursPerWeek||0)>=5),d=a.filter(e=>5>(e.hoursPerWeek||0));for(let s of o)for(let t=0;t<this.DAYS.length&&!(i.hoursPlaced[s.name]>=s.hoursPerWeek);t++)this._placeTheoryDayPriority(e,s,l,i,r,t)&&(i.hoursPlaced[s.name]+=1);for(let s of[...d].sort((e,s)=>(e.hoursPerWeek||0)-(s.hoursPerWeek||0))){let t=0;for(;i.hoursPlaced[s.name]<(s.hoursPerWeek||0)&&t<150;)this._placeTheorySpread(e,s,l,i,r)?i.hoursPlaced[s.name]++:t++}for(let s of[...o,...a.filter(e=>(e.hoursPerWeek||0)>5&&!o.includes(e))].sort((e,s)=>(s.hoursPerWeek||0)-(e.hoursPerWeek||0))){let t=0;for(;i.hoursPlaced[s.name]<(s.hoursPerWeek||0)&&t<400;)this._placeTheorySpread(e,s,l,i,r)||this._placeTheoryRelaxed(e,s,l,i,r)||this._placeTheoryForce(e,s,l,i,r)?i.hoursPlaced[s.name]++:t++;for(;i.hoursPlaced[s.name]<(s.hoursPerWeek||0);){if(!this._ultraDesperatePlace(e,s,l,i,r))return console.error("IMPOSSIBLE: No free slots for ${s.name} (class ${className})"),!1;i.hoursPlaced[s.name]++}}return this._countPlacedHours(e)===this.TOTAL_HOURS||(console.error("Class ${className} final hours ${placed} != ${this.TOTAL_HOURS}"),!1)}_countPlacedHours(e){let s=this.classTimetables[e],t=0;for(let e=0;e<this.DAYS.length;e++)for(let a=0;a<this.PERIODS;a++)s[e][a]&&t++;return t}_placeLabBlock_withMaxPerDay(e,s,t,a,l){let i=s.teacher,r=[];for(let e of this._shuffle([0,1,2,3,4]))if(!((l[e]||0)>=2))for(let l of this._shuffle([0,1,2,3,4])){if(l>this.PERIODS-2||t[e][l]||t[e][l+1]||this.teacherSlots[i]?.["${this.DAYS[dayIdx]}-P${startP+1}"]||this.teacherSlots[i]?.["${this.DAYS[dayIdx]}-P${startP+2}"]||a.daysUsedByLab[s.name].has(e))continue;let n=100;a.daysUsedByLab[s.name].has(e)||(n+=80);let o="P${startP+1}-P${startP+2}",d=a.blockUsageCount[s.name][o]||0;0===d?n+=60:n-=50*d;let c=this.DAYS[e];n+=(2-(this.globalLabDayCount[c]||0))*20,r.push({dayIdx:e,startP:l,score:n,blockKey:o})}if(!r.length)return!1;r.sort((e,s)=>s.score-e.score);let n=this._pickRandomFromTopN(r,6);return!!n&&(t[n.dayIdx][n.startP]={subject:s.name,teacher:i,type:s.subjectType||"lab",isLab:!0},t[n.dayIdx][n.startP+1]={subject:s.name,teacher:i,type:s.subjectType||"lab",isLab:!0,isLabContinuation:!0},this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i]["${this.DAYS[pick.dayIdx]}-P${pick.startP+1}"]=e,this.teacherSlots[i]["${this.DAYS[pick.dayIdx]}-P${pick.startP+2}"]=e,a.daysUsedByLab[s.name].add(n.dayIdx),a.periodsUsedByLab[s.name].add(n.startP),a.blockUsageCount[s.name][n.blockKey]=(a.blockUsageCount[s.name][n.blockKey]||0)+1,a.lastDayIdx[s.name]=n.dayIdx,l[n.dayIdx]=(l[n.dayIdx]||0)+2,this.globalLabDayCount[this.DAYS[n.dayIdx]]=(this.globalLabDayCount[this.DAYS[n.dayIdx]]||0)+1,!0)}_placeLabSingle_withMaxPerDay(e,s,t,a,l){let i=s.teacher,r=[];for(let e of this._shuffle([0,1,2,3,4]))if(!((l[e]||0)+1>2))for(let l of this._shuffle([0,1,2,3,4,5])){if(t[e][l]||this.teacherSlots[i]?.["${this.DAYS[dayIdx]}-P${p+1}"]||a.daysUsedByLab[s.name].has(e))continue;let n=80;a.daysUsedByLab[s.name].has(e)||(n+=40),r.push({dayIdx:e,p:l,score:n})}if(!r.length)return!1;r.sort((e,s)=>s.score-e.score);let n=this._pickRandomFromTopN(r,6);return!!n&&(t[n.dayIdx][n.p]={subject:s.name,teacher:i,type:s.subjectType||"lab",isLab:!0,isLabSingle:!0},this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i]["${this.DAYS[pick.dayIdx]}-P${pick.p+1}"]=e,a.daysUsedByLab[s.name].add(n.dayIdx),a.periodsUsedByLab[s.name].add(n.p),l[n.dayIdx]=(l[n.dayIdx]||0)+1,this.globalLabDayCount[this.DAYS[n.dayIdx]]=(this.globalLabDayCount[this.DAYS[n.dayIdx]]||0)+1,!0)}_placeTheoryDayPriority(e,s,t,a,l,i){let r=s.teacher,n=this.DAYS[i],o=[];for(let e of this._shuffle([0,1,2,3,4,5])){if(t[i][e]||this.teacherSlots[r]?.["${dayName}-P${p+1}"]||e>0&&t[i][e-1]&&this._isSameBase(t[i][e-1].subject,s.name)||e<this.PERIODS-1&&t[i][e+1]&&this._isSameBase(t[i][e+1].subject,s.name)||i>0&&a.dayPeriodMap[s.name]?.[i-1]===e)continue;let l=a.dayPeriodMap[s.name]?.[i-1];if(null!=l&&(e===l-1||e===l+1))continue;let d=100;a.periodWeeklyCount[s.name]||(a.periodWeeklyCount[s.name]=Array(this.PERIODS).fill(0));let c=a.periodWeeklyCount[s.name][e]||0;d+=0===c?60:-30*c,e>=1&&e<=4&&(d+=10),o.push({dayIdx:i,p:e,score:d,dayName:n})}if(!o.length)return!1;o.sort((e,s)=>s.score-e.score);let d=this._pickRandomFromTopN(o,6);return!!d&&(t[d.dayIdx][d.p]={subject:s.name,teacher:r,type:s.subjectType||"core"},this.teacherSlots[r]||(this.teacherSlots[r]={}),this.teacherSlots[r]["${this.DAYS[pick.dayIdx]}-P${pick.p+1}"]=e,a.daysUsed[s.name].add(d.dayIdx),a.dayPeriodMap[s.name][d.dayIdx]=d.p,a.periodWeeklyCount[s.name][d.p]=(a.periodWeeklyCount[s.name][d.p]||0)+1,a.zonesUsed[s.name].add(this._zone(d.p)),a.lastPeriod[s.name]=d.p,a.subjectBaseDays[this._getBaseSubjectName(s.name)].add(d.dayIdx),!0)}_placeTheorySpread(e,s,t,a,l){let i=s.teacher,r=[];for(let e of this._shuffle([0,1,2,3,4]))for(let l of this._shuffle([0,1,2,3,4,5])){if(t[e][l]||this.teacherSlots[i]?.["${this.DAYS[dayIdx]}-P${p+1}"]||l>0&&t[e][l-1]&&this._isSameBase(t[e][l-1].subject,s.name)||l<this.PERIODS-1&&t[e][l+1]&&this._isSameBase(t[e][l+1].subject,s.name)||e>0&&a.dayPeriodMap[s.name]?.[e-1]===l)continue;let n=a.dayPeriodMap[s.name]?.[e-1];if(null!=n&&(l===n-1||l===n+1)||(a.periodWeeklyCount[s.name][l]||0)>=2)continue;let o=100;a.daysUsed[s.name].has(e)||(o+=50);let d=this._zone(l);a.zonesUsed[s.name].has(d)||(o+=40);let c=a.periodWeeklyCount[s.name][l]||0;o+=0===c?60:-40*c,r.push({dayIdx:e,p:l,score:o})}if(!r.length)return!1;r.sort((e,s)=>s.score-e.score);let n=this._pickRandomFromTopN(r,7);return!!n&&(t[n.dayIdx][n.p]={subject:s.name,teacher:i,type:s.subjectType||"core"},this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i]["${this.DAYS[pick.dayIdx]}-P${pick.p+1}"]=e,a.daysUsed[s.name].add(n.dayIdx),a.dayPeriodMap[s.name][n.dayIdx]=n.p,a.periodWeeklyCount[s.name][n.p]=(a.periodWeeklyCount[s.name][n.p]||0)+1,a.zonesUsed[s.name].add(this._zone(n.p)),a.lastPeriod[s.name]=n.p,a.subjectBaseDays[this._getBaseSubjectName(s.name)].add(n.dayIdx),!0)}_placeTheoryRelaxed(e,s,t,a,l){let i=s.teacher,r=[];for(let e of this._shuffle([0,1,2,3,4]))for(let l of this._shuffle([0,1,2,3,4,5])){if(t[e][l]||this.teacherSlots[i]?.["${this.DAYS[dayIdx]}-P${p+1}"]||l>0&&t[e][l-1]&&this._isSameBase(t[e][l-1].subject,s.name)||l<this.PERIODS-1&&t[e][l+1]&&this._isSameBase(t[e][l+1].subject,s.name))continue;let n=a.dayPeriodMap[s.name]?.[e-1];if(null!=n&&(l===n-1||l===n+1)||(a.periodWeeklyCount[s.name][l]||0)>=3)continue;let o=70;a.daysUsed[s.name].has(e)||(o+=40);let d=this._zone(l);a.zonesUsed[s.name].has(d)||(o+=30),o+=a.periodWeeklyCount[s.name][l]?-20:40,r.push({dayIdx:e,p:l,score:o})}if(!r.length)return!1;r.sort((e,s)=>s.score-e.score);let n=this._pickRandomFromTopN(r,9);return!!n&&(t[n.dayIdx][n.p]={subject:s.name,teacher:i,type:s.subjectType||"core"},this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i]["${this.DAYS[pick.dayIdx]}-P${pick.p+1}"]=e,a.daysUsed[s.name].add(n.dayIdx),a.dayPeriodMap[s.name][n.dayIdx]=n.p,a.periodWeeklyCount[s.name][n.p]=(a.periodWeeklyCount[s.name][n.p]||0)+1,a.zonesUsed[s.name].add(this._zone(n.p)),a.lastPeriod[s.name]=n.p,a.subjectBaseDays[this._getBaseSubjectName(s.name)].add(n.dayIdx),!0)}_placeTheoryForce(e,s,t,a,l){let i=s.teacher;for(let l=0;l<5;l++)for(let r=0;r<this.PERIODS;r++){if(t[l][r])continue;let n="${this.DAYS[dayIdx]}-P${p+1}";if(this.teacherSlots[i]?.[n]||r>0&&t[l][r-1]&&this._isSameBase(t[l][r-1].subject,s.name)||r<this.PERIODS-1&&t[l][r+1]&&this._isSameBase(t[l][r+1].subject,s.name))continue;let o=a.dayPeriodMap[s.name]?.[l-1];if(null==o||r!==o-1&&r!==o+1)return t[l][r]={subject:s.name,teacher:i,type:s.subjectType||"core"},this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i][n]=e,a.daysUsed[s.name].add(l),a.dayPeriodMap[s.name][l]=r,a.periodWeeklyCount[s.name][r]=(a.periodWeeklyCount[s.name][r]||0)+1,a.zonesUsed[s.name].add(this._zone(r)),a.lastPeriod[s.name]=r,a.subjectBaseDays[this._getBaseSubjectName(s.name)].add(l),!0}return!1}_ultraDesperatePlace(e,s,t,a,l){let i=s.teacher;for(let l=0;l<5;l++)for(let r=0;r<this.PERIODS;r++){if(t[l][r])continue;let n="${this.DAYS[dayIdx]}-P${p+1}";if(!(this.teacherSlots[i]?.[n]||r>0&&t[l][r-1]&&this._isSameBase(t[l][r-1].subject,s.name))&&!(r<this.PERIODS-1&&t[l][r+1]&&this._isSameBase(t[l][r+1].subject,s.name)))return t[l][r]={subject:s.name,teacher:i,type:s.subjectType||"core",isUltra:!0},this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i][n]=e,a.daysUsed[s.name].add(l),a.dayPeriodMap[s.name][l]=r,a.periodWeeklyCount[s.name][r]=(a.periodWeeklyCount[s.name][r]||0)+1,a.zonesUsed[s.name].add(this._zone(r)),a.lastPeriod[s.name]=r,a.subjectBaseDays[this._getBaseSubjectName(s.name)].add(l),!0}for(let l=0;l<5;l++)for(let r=0;r<this.PERIODS;r++){if(t[l][r])continue;let n="${this.DAYS[dayIdx]}-P${p+1}";if(!this.teacherSlots[i]?.[n])return t[l][r]={subject:s.name,teacher:i,type:s.subjectType||"core",isUltra:!0},this.teacherSlots[i]||(this.teacherSlots[i]={}),this.teacherSlots[i][n]=e,a.daysUsed[s.name].add(l),a.dayPeriodMap[s.name][l]=r,a.periodWeeklyCount[s.name][r]=(a.periodWeeklyCount[s.name][r]||0)+1,a.zonesUsed[s.name].add(this._zone(r)),a.lastPeriod[s.name]=r,a.subjectBaseDays[this._getBaseSubjectName(s.name)].add(l),!0}return!1}}});
//# sourceMappingURL=AdminDashboard.4cb81e05.js.map
